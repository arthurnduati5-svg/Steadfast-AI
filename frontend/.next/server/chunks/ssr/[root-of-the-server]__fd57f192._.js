module.exports = {

"[externals]/node:async_hooks [external] (node:async_hooks, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:async_hooks", () => require("node:async_hooks"));

module.exports = mod;
}}),
"[externals]/express [external] (express, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("express", () => require("express"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/perf_hooks [external] (perf_hooks, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("perf_hooks", () => require("perf_hooks"));

module.exports = mod;
}}),
"[externals]/node:perf_hooks [external] (node:perf_hooks, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:perf_hooks", () => require("node:perf_hooks"));

module.exports = mod;
}}),
"[externals]/async_hooks [external] (async_hooks, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("async_hooks", () => require("async_hooks"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/child_process [external] (child_process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/require-in-the-middle [external] (require-in-the-middle, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("require-in-the-middle", () => require("require-in-the-middle"));

module.exports = mod;
}}),
"[externals]/import-in-the-middle [external] (import-in-the-middle, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("import-in-the-middle", () => require("import-in-the-middle"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/http2 [external] (http2, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}}),
"[externals]/dns [external] (dns, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}}),
"[externals]/dgram [external] (dgram, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dgram", () => require("dgram"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/node:process [external] (node:process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/string_decoder [external] (string_decoder, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}}),
"[externals]/firebase-admin/auth [external] (firebase-admin/auth, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("firebase-admin/auth", () => require("firebase-admin/auth"));

module.exports = mod;
}}),
"[externals]/firebase-admin/app [external] (firebase-admin/app, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("firebase-admin/app", () => require("firebase-admin/app"));

module.exports = mod;
}}),
"[externals]/firebase-admin/app-check [external] (firebase-admin/app-check, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("firebase-admin/app-check", () => require("firebase-admin/app-check"));

module.exports = mod;
}}),
"[externals]/firebase-admin/database [external] (firebase-admin/database, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("firebase-admin/database", () => require("firebase-admin/database"));

module.exports = mod;
}}),
"[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("firebase-admin/firestore", () => require("firebase-admin/firestore"));

module.exports = mod;
}}),
"[project]/AI/ai/flows/get-youtube-transcript.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "getYoutubeTranscriptFlow": (()=>getYoutubeTranscriptFlow)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$youtube$2d$transcript$2f$dist$2f$youtube$2d$transcript$2e$esm$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/youtube-transcript/dist/youtube-transcript.esm.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
;
;
;
const youtubeTranscriptInputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    videoId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
const getYoutubeTranscriptFlow = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["defineFlow"])({
    name: 'getYoutubeTranscriptFlow',
    inputSchema: youtubeTranscriptInputSchema,
    outputSchema: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
}, async (input)=>{
    try {
        if (!input.videoId) {
            throw new Error("Video ID is missing");
        }
        const transcriptItems = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$youtube$2d$transcript$2f$dist$2f$youtube$2d$transcript$2e$esm$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["YoutubeTranscript"].fetchTranscript(input.videoId);
        if (!transcriptItems || transcriptItems.length === 0) {
            return 'Could not fetch the transcript for this video (it might not have captions).';
        }
        // Join text with spaces, replacing newlines to create a continuous block of text
        return transcriptItems.map((item)=>item.text).join(' ').replace(/\n/g, ' ').trim();
    } catch (error) {
        console.error('Error fetching YouTube transcript:', error);
        return 'Could not fetch the transcript for this video.';
    }
});
}}),
"[project]/AI/ai/flows/youtube-search-flow.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "YoutubeSearchFlowOutputSchema": (()=>YoutubeSearchFlowOutputSchema),
    "youtubeSearchFlow": (()=>youtubeSearchFlow)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$youtube$2d$search$2d$api$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/youtube-search-api/dist/index.js [app-rsc] (ecmascript)");
;
;
;
const YoutubeSearchFlowOutputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    title: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    channel: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    channelTitle: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    thumbnailUrl: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    videoId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
// ðŸ›‘ STRICT EDUCATIONAL FILTER
const BANNED_KEYWORDS = [
    "official video",
    "lyrics",
    "music video",
    "song",
    "mp3",
    "remix",
    "cover",
    "vevo",
    "karaoke",
    "concert",
    "live performance",
    "album",
    "single",
    "ft.",
    "feat."
];
function isEducational(video) {
    const text = (video.title + " " + (video.channel?.name || "")).toLowerCase();
    return !BANNED_KEYWORDS.some((keyword)=>text.includes(keyword));
}
const youtubeSearchFlow = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["defineFlow"])({
    name: 'youtubeSearchFlow',
    inputSchema: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
    }),
    outputSchema: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(YoutubeSearchFlowOutputSchema)
}, async (input)=>{
    try {
        console.log(`[ðŸ” DEEP TRACE] ðŸš€ YouTube search: "${input.query}"`);
        // Request 10 videos so we have enough buffer after filtering
        const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$youtube$2d$search$2d$api$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GetListByKeyword"])(input.query, false, 10, [
            {
                type: 'video'
            }
        ]);
        if (!response || !response.items || response.items.length === 0) {
            return [];
        }
        // Filter and Map
        const cleanedResults = response.items.filter(isEducational) // âœ… APPLY HARD FILTER
        .map((video)=>{
            let safeChannel = video.channel?.name || '';
            if (safeChannel === 'Unknown Channel' || safeChannel === 'undefined') safeChannel = '';
            return {
                id: video.id,
                title: video.title || 'Educational Video',
                channel: safeChannel,
                channelTitle: safeChannel,
                thumbnailUrl: video.thumbnail?.url || `https://img.youtube.com/vi/${video.id}/0.jpg`,
                videoId: video.id
            };
        }).slice(0, 3); // Return top 3 filtered results
        console.log(`[ðŸ” DEEP TRACE] âœ… Found ${cleanedResults.length} Educational videos.`);
        return cleanedResults;
    } catch (error) {
        console.error('[ðŸ” DEEP TRACE] âŒ Error in youtubeSearchFlow:', error);
        return [];
    }
});
}}),
"[externals]/fs/promises [external] (fs/promises, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs/promises", () => require("fs/promises"));

module.exports = mod;
}}),
"[externals]/node:crypto [external] (node:crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}}),
"[externals]/node:fs [external] (node:fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:fs", () => require("node:fs"));

module.exports = mod;
}}),
"[externals]/node:stream [external] (node:stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}}),
"[externals]/node:stream/web [external] (node:stream/web, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:stream/web", () => require("node:stream/web"));

module.exports = mod;
}}),
"[externals]/worker_threads [external] (worker_threads, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("worker_threads", () => require("worker_threads"));

module.exports = mod;
}}),
"[project]/AI/ai/genkit.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "ai": (()=>ai),
    "serperSearchTool": (()=>serperSearchTool)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/genkit/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$genkit$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/genkit/lib/genkit.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/genkit/lib/common.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkitx$2d$openai$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/genkitx-openai/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkitx$2d$openai$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/genkitx-openai/lib/index.mjs [app-rsc] (ecmascript) <locals>");
;
;
const ai = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$genkit$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["genkit"])({
    plugins: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkitx$2d$openai$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$locals$3e$__["openAI"])({
            apiKey: process.env.OPENAI_API_KEY
        })
    ]
});
const serperSearchTool = ai.defineTool({
    name: 'serperSearch',
    description: 'Performs a google search using Serper.dev.',
    inputSchema: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().describe('The search query.')
    }),
    outputSchema: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        results: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
            title: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            link: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
            snippet: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
        })).optional()
    })
}, async (input)=>{
    console.log(`[ðŸ” DEEP TRACE] Tool 'serperSearch' called with query: "${input.query}"`);
    const apiKey = process.env.SERPER_API_KEY;
    if (!apiKey) {
        console.warn("[ðŸ” DEEP TRACE] âŒ NO API KEY FOUND in .env (SERPER_API_KEY). Returning empty results.");
        return {
            results: []
        };
    }
    try {
        console.log(`[ðŸ” DEEP TRACE] ðŸ“¡ Sending request to Serper.dev...`);
        const response = await fetch('https://google.serper.dev/search', {
            method: 'POST',
            headers: {
                'X-API-KEY': apiKey,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                q: input.query
            })
        });
        console.log(`[ðŸ” DEEP TRACE] ðŸ“¡ API Response Status: ${response.status}`);
        // SPECIFIC CHECK FOR KEY MISMATCH
        if (response.status === 403) {
            console.error(`[ðŸ” DEEP TRACE] â›”ï¸ 403 FORBIDDEN. This usually means you are using a SerpAPI key (starts with 'e...') for Serper.dev. You need a Serper.dev key (starts with 'gl...').`);
            return {
                results: []
            };
        }
        if (!response.ok) {
            console.error(`[ðŸ” DEEP TRACE] âŒ API Error: ${response.statusText}`);
            return {
                results: []
            };
        }
        const data = await response.json();
        const results = data.organic?.map((item)=>({
                title: item.title || 'No title',
                link: item.link || '',
                snippet: item.snippet || ''
            })) || [];
        console.log(`[ðŸ” DEEP TRACE] âœ… API Success. Received ${results.length} results.`);
        return {
            results
        };
    } catch (error) {
        console.error('[ðŸ” DEEP TRACE] âŒ CRITICAL TOOL ERROR:', error.message);
        return {
            results: []
        };
    }
});
}}),
"[project]/AI/lib/research/research-state.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "assertMode": (()=>assertMode),
    "getMode": (()=>getMode),
    "setMode": (()=>setMode)
});
let currentMode = 'chat';
function setMode(mode) {
    currentMode = mode;
}
function getMode() {
    return currentMode;
}
function assertMode(expected) {
    if (currentMode !== expected) {
        throw new Error(`Invalid mode access. Expected "${expected}" but current mode is "${currentMode}".`);
    }
}
}}),
"[project]/AI/lib/research/persona-lock.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "enforceNoPersona": (()=>enforceNoPersona),
    "personaAllowed": (()=>personaAllowed)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$research$2f$research$2d$state$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/lib/research/research-state.ts [app-rsc] (ecmascript)");
;
function personaAllowed() {
    const mode = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$research$2f$research$2d$state$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getMode"])();
    return mode === 'teaching' || mode === 'chat';
}
function enforceNoPersona(prompt) {
    if (!personaAllowed()) {
        return `
SYSTEM RULE:
- teaching tone
- No metaphors
- No examples
- No opinions
- No emotions

${prompt}
`;
    }
    return prompt;
}
}}),
"[project]/AI/ai/flows/intent-detector.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "detectResearchIntent": (()=>detectResearchIntent)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/genkit.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$research$2f$persona$2d$lock$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/lib/research/persona-lock.ts [app-rsc] (ecmascript)");
;
;
async function detectResearchIntent(query, lastTopic) {
    const prompt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$research$2f$persona$2d$lock$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["enforceNoPersona"])(`
Classify the student's intent based on their input and the conversation context.

Student input: "${query}"
Active Topic: "${lastTopic || 'none'}"

CATEGORIES:
1. **dialogue_continuation**: Short conversational replies (e.g., "Yes", "No", "Okay", "Go on", "I understand", "Next", "Sure").
2. **clarification**: Asking follow-up questions about the ACTIVE TOPIC (e.g., "What about plants?", "Explain that part again", "Why?").
3. **video_lookup**: Explicitly asking for a video.
4. **greeting**: "Hi", "Hello".
5. **fact_lookup**: Asking for a specific NEW fact (e.g., "Who discovered oxygen?").
6. **deep_research**: Asking to learn a completely NEW broad topic (e.g. "I want to research Photosynthesis").
7. **practice**: "Test me", "Give me a quiz".

RULES:
- If the input is "Yes", "Okay", or "Continue", it is ALWAYS 'dialogue_continuation'.
- If the input refers to the Active Topic (e.g. "How does *it* work?"), it is 'clarification'.
- Only use 'deep_research' if the user explicitly changes the subject.

Respond ONLY with the category name.
`);
    try {
        const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
            model: 'openai/gpt-4o-mini',
            prompt
        });
        return res.text.trim().toLowerCase();
    } catch  {
        return 'clarification'; // Default to chat, not search
    }
}
}}),
"[externals]/node:assert [external] (node:assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:assert", () => require("node:assert"));

module.exports = mod;
}}),
"[externals]/node:net [external] (node:net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:net", () => require("node:net"));

module.exports = mod;
}}),
"[externals]/node:http [external] (node:http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}}),
"[externals]/node:querystring [external] (node:querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:querystring", () => require("node:querystring"));

module.exports = mod;
}}),
"[externals]/node:diagnostics_channel [external] (node:diagnostics_channel, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:diagnostics_channel", () => require("node:diagnostics_channel"));

module.exports = mod;
}}),
"[externals]/node:tls [external] (node:tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:tls", () => require("node:tls"));

module.exports = mod;
}}),
"[externals]/node:buffer [external] (node:buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:buffer", () => require("node:buffer"));

module.exports = mod;
}}),
"[externals]/node:zlib [external] (node:zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}}),
"[externals]/node:util/types [external] (node:util/types, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util/types", () => require("node:util/types"));

module.exports = mod;
}}),
"[externals]/node:worker_threads [external] (node:worker_threads, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:worker_threads", () => require("node:worker_threads"));

module.exports = mod;
}}),
"[externals]/node:http2 [external] (node:http2, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:http2", () => require("node:http2"));

module.exports = mod;
}}),
"[externals]/node:console [external] (node:console, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:console", () => require("node:console"));

module.exports = mod;
}}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}}),
"[externals]/node:path [external] (node:path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:path", () => require("node:path"));

module.exports = mod;
}}),
"[externals]/node:timers [external] (node:timers, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:timers", () => require("node:timers"));

module.exports = mod;
}}),
"[externals]/node:dns [external] (node:dns, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:dns", () => require("node:dns"));

module.exports = mod;
}}),
"[project]/AI/ai/flows/web_search_flow.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "webSearchFlow": (()=>webSearchFlow)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/genkit.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/tools/handlers.ts [app-rsc] (ecmascript)");
;
;
;
;
/* ======================================================
   1. STRICT TEACHING PERSONA (MICRO-LEARNING)
====================================================== */ const teachingSystemPrompt = `
SYSTEM ROLE: ELITE PRIVATE TUTOR

You are STEADFAST, a warm, professional Kenyan teacher.
You teach students from elite backgrounds who expect clarity, precision, and a step-by-step approach.

**YOUR TEACHING METHOD (MICRO-LEARNING):**
1. **ONE IDEA PER TURN:** Never explain a whole topic at once. Teach one layer, check understanding, then move deeper.
2. **ADAPTABILITY:** 
   - If the student understands (says "Yes", "Okay", "Go on"): Move to the next concept (e.g., "Great! Now let's look at the two types...").
   - If the student is confused: Simplify. Use a relatable Kenyan analogy (e.g., farming, business).
3. **TONE:** Professional, encouraging, and never patronizing.
4. **NO LABELS:** Speak naturally. Never say "Guiding Question:".
5. **NO META-TALK:** Never mention sources or AI limitations.

**GREETING RULE:**
- If the user says "hi/hello", generate a UNIQUE, classy, warm greeting. Never repeat "Hello! How can I assist you...".
`;
/* ======================================================
   2. SCHEMAS
====================================================== */ const InputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    chatHistory: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        content: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
    })).optional().default([]),
    lastSearchTopic: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    searchResultSummary: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    awaitingPracticeQuestion: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(false),
    awaitingPracticeAnswer: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(false),
    correctAnswers: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()).optional(),
    attempts: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number().default(0),
    forceWebSearch: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(false).optional()
});
const OutputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    response: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    awaitingPracticeQuestion: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().optional(),
    awaitingPracticeAnswer: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().optional(),
    correctAnswers: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()).optional(),
    attempts: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].number().optional(),
    lastSearchTopic: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
    searchResultSummary: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
});
function clean(text) {
    return text.replace(/\s+/g, ' ').trim();
}
/* ======================================================
   4. PRACTICE QUESTION GENERATOR
====================================================== */ async function generatePracticeQuestion(topic) {
    const prompt = `Topic: "${topic}". Generate 1 simple practice question and answer. Format: QUESTION: ... ANSWERS: a,b`;
    const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
        model: 'openai/gpt-4o',
        prompt
    });
    const qMatch = res.text.match(/QUESTION:\s*(.*)/);
    const aMatch = res.text.match(/ANSWERS:\s*(.*)/);
    return {
        question: qMatch?.[1] ?? `What is a key fact about ${topic}?`,
        answers: aMatch ? aMatch[1].split(',').map((a)=>a.trim().toLowerCase()) : []
    };
}
const webSearchFlow = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["defineFlow"])({
    name: 'webSearchFlow',
    inputSchema: InputSchema,
    outputSchema: OutputSchema
}, async (input)=>{
    const { query, chatHistory, searchResultSummary, awaitingPracticeQuestion, awaitingPracticeAnswer, correctAnswers = [], attempts } = input;
    // 1. TEACH NEW CONTENT (INITIAL RESEARCH)
    if (searchResultSummary && !awaitingPracticeQuestion && !awaitingPracticeAnswer) {
        const prompt = `
      Verified Fact: "${searchResultSummary}"
      
      TASK: Teach this concept.
      - **10% Rule:** Teach only the definition. No deep details yet.
      - **Length:** 3-5 sentences.
      - End with a natural checking question.
      `;
        const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
            model: 'openai/gpt-4o',
            prompt: `${teachingSystemPrompt}\n${prompt}`
        });
        return {
            response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(clean(res.text)),
            awaitingPracticeQuestion: true,
            lastSearchTopic: input.lastSearchTopic,
            searchResultSummary
        };
    }
    // 2. PRACTICE CONFIRMATION
    if (awaitingPracticeQuestion) {
        if (/^(yes|ok|sure|go on|teach me|continue)/i.test(query)) {
            const pq = await generatePracticeQuestion(input.lastSearchTopic || 'this topic');
            return {
                response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(clean(pq.question)),
                awaitingPracticeQuestion: false,
                awaitingPracticeAnswer: true,
                correctAnswers: pq.answers,
                attempts: 0,
                lastSearchTopic: input.lastSearchTopic,
                searchResultSummary
            };
        }
        // If student says "I don't understand" or similar
        const prompt = `Student said: "${query}". They might be confused or want to move on. Respond helpfully. If confused, simplify the previous concept.`;
        const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
            model: 'openai/gpt-4o',
            prompt: `${teachingSystemPrompt}\n${prompt}`
        });
        return {
            response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(clean(res.text)),
            awaitingPracticeQuestion: false
        };
    }
    // 3. ANSWER VALIDATION
    if (awaitingPracticeAnswer) {
        const normalized = query.toLowerCase();
        const isCorrect = correctAnswers.some((a)=>normalized.includes(a));
        if (isCorrect) {
            const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
                model: 'openai/gpt-4o',
                prompt: `${teachingSystemPrompt} Student correct. Briefly explain why. Ask if ready for next concept.`
            });
            return {
                response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(clean(res.text)),
                awaitingPracticeAnswer: false
            };
        }
        if (attempts >= 2) {
            return {
                response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])('Good effort. Let me explain simply.'),
                awaitingPracticeAnswer: false,
                lastSearchTopic: input.lastSearchTopic
            };
        }
        return {
            response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])('Almost. Try again.'),
            awaitingPracticeAnswer: true,
            attempts: attempts + 1,
            correctAnswers
        };
    }
    // 4. FALLBACK / CHAT LOGIC (THE "BRAIN" FOR YES/NO)
    const recentHistory = chatHistory.slice(-4).map((m)=>`${m.role.toUpperCase()}: ${m.content}`).join('\n');
    const fallbackResponse = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
        model: 'openai/gpt-4o',
        prompt: `${teachingSystemPrompt}
       
       ACTIVE TOPIC: "${input.lastSearchTopic || 'General Chat'}"
       RECENT HISTORY:
       ${recentHistory}
       
       STUDENT INPUT: "${query}"
       
       TASK:
       - If Input is "Yes/Okay/Go on": TEACH THE NEXT CONCEPT related to "${input.lastSearchTopic}". Do not define "Yes".
       - If Input is "No/Confused": Explain the PREVIOUS concept simpler.
       - If greeting: Warm, unique greeting.
       - NO LABELS.
       `
    });
    return {
        response: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(clean(fallbackResponse.text))
    };
});
}}),
"[externals]/node:timers/promises [external] (node:timers/promises, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:timers/promises", () => require("node:timers/promises"));

module.exports = mod;
}}),
"[externals]/dns/promises [external] (dns/promises, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dns/promises", () => require("dns/promises"));

module.exports = mod;
}}),
"[externals]/node:url [external] (node:url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:url", () => require("node:url"));

module.exports = mod;
}}),
"[project]/AI/lib/redis.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "getRedisClient": (()=>getRedisClient)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$redis$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/redis/dist/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$dotenv$2f$config$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/dotenv/config.js [app-rsc] (ecmascript)");
;
;
const REDIS_URL = process.env.REDIS_URL || "redis://default:BTBiyWPQQzFYUFHDZrjnmNhRdnuQoLRd@caboose.proxy.rlwy.net:44313";
let clientInstance = null;
let isConnecting = false;
// Initialize client immediately but don't connect yet
const client = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$redis$2f$dist$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createClient"])({
    url: REDIS_URL,
    // CRITICAL: Fail fast if disconnected. 
    // Don't queue commands in memory (which causes hangs/crashes if Redis is down)
    disableOfflineQueue: true,
    socket: {
        connectTimeout: 5000,
        reconnectStrategy: (retries)=>{
            // Exponential backoff: wait longer between retries, max 3 seconds
            // If retries > 10, stop trying for a while (return error) to stop log spam
            if (retries > 10) {
                console.warn('[Redis] Too many reconnect attempts. Cooling down.');
                return 5000;
            }
            return Math.min(retries * 100, 3000);
        }
    }
});
// Global error handler to prevent crashing the process
client.on('error', (err)=>{
    // Suppress the log spam for common connectivity issues
    if (err.message.includes('ECONNRESET') || err.message.includes('Socket closed')) {
    // Silent fail or low-level debug
    // console.debug('[Redis] Connection lost (handled).'); 
    } else {
        console.error('[Redis] Client Error:', err.message);
    }
});
client.on('connect', ()=>console.log('[Redis] Connected.'));
client.on('ready', ()=>console.log('[Redis] Ready.'));
client.on('end', ()=>{});
async function getRedisClient() {
    // If ready, return immediately
    if (client.isOpen && client.isReady) {
        return client;
    }
    // If already connecting, return null (fallback to DB) rather than queueing
    if (isConnecting) {
        return null;
    }
    try {
        isConnecting = true;
        await client.connect();
        isConnecting = false;
        return client;
    } catch (error) {
        isConnecting = false;
        // Don't throw. Return null so the app falls back to the Database.
        console.warn('[Redis] Connection failed. Using Database fallback.');
        return null;
    }
}
}}),
"[project]/AI/ai/data/curriculum.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
// src/ai/data/curriculum.ts
__turbopack_context__.s({
    "CURRICULUM_MAP": (()=>CURRICULUM_MAP)
});
const CURRICULUM_MAP = new Map([
    [
        "simultaneous",
        {
            microIdea: "A simultaneous equation is just a puzzle where we use two clues to find two prices.",
            example: "Imagine you go to the kiosk. One friend buys 2 Mandazis and 1 Chai for 40 shillings. That is your first clue.",
            question: "Can you write that clue as a simple math sentence? Use M for Mandazi and C for Chai."
        }
    ],
    [
        "equation",
        {
            microIdea: "An equation is like a balance scale. Both sides must weigh the same.",
            example: "If you have 1kg of Sugar on one side, you need 1kg of weight on the other.",
            question: "If x + 5 = 10, what must 'x' be to keep the scale balanced?"
        }
    ],
    [
        "fraction",
        {
            microIdea: "A fraction is simply sharing one whole thing into equal parts.",
            example: "Think of one hot Chapati. If you cut it into 4 equal pieces for your friends, one piece is (1 / 4).",
            question: "If you eat two of those pieces, how much of that Chapati is gone?"
        }
    ],
    [
        "geometry",
        {
            microIdea: "Geometry helps us measure the space and shapes around us.",
            example: "Think of the rectangle of a football field, or the circle of a bicycle wheel.",
            question: "If we walk all the way around the field, what do we call that distance?"
        }
    ],
    [
        "photosynthesis",
        {
            microIdea: "Plants are like chefs. They cook their own food using nothing but sunlight.",
            example: "Think of the maize in the shamba standing in the sun all day. It's working hard to grow food.",
            question: "What is the one thing the maize must take from the air to finish its cooking?"
        }
    ],
    [
        "ratios",
        {
            microIdea: "A ratio is just comparing two groups using a colon : ",
            example: "If you are mixing concrete for a house, you might mix 1 bucket of cement with 3 buckets of sand.",
            question: "How would you write the ratio of cement to sand? (Hint: Use the : symbol)"
        }
    ]
]);
}}),
"[project]/AI/ai/tools/handlers.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"401234c057aa0a60951845bf417528ca44bfa83723":"get_youtube_transcript_tool","40238f3d20bb56f1203063639893662f2885c2b432":"math_validate_answer","402882abddf318a939e5457bfb5412013e89e129a4":"emoji_policy_check","403550acae54d30f6c46cf4fe1d5953375c0cac7c1":"arabic_mode_formatter","405a304fa1ccebc6cf0aea5d281e0b7fa5a2ebd93c":"emotional_decoder","408026694efe1e132aa52e458a971fa7e0a2728432":"youtube_search_tool","4088e462acf38611aa0ed4d77ad40fb6df0091a336":"ask_practice_question","409279fdfaaee157148f1cfa5a0a989400b4be133a":"quran_pedagogy","4096a6b4065b7f0fd1b00ee40d7d1dab4d8c6d16e0":"isArabicText","40a37b0b3bbeedc718676e2e6136aa4b7ed100f46c":"formatting_polisher","40d1e79945752f4cf0a6c8e74f2d514b5fec623688":"math_generate_question","40eddd522e6a57d99c7f74d7d4ffddebe510d00373":"teaching_micro_step","40f0fa5c31ba3c105c8ba180eb0879b36fa76d87ec":"tone_generator","607238008f995c74ccf6d542ddf06f729434b71cf6":"GUARDIAN_SANITIZE","608460b3cec03ff1f7b1e9a43db382d315f393a300":"memory_manager","704d26bbc880ddba6b4f6bbc66a4456322cec02ea4":"toolRouter"},"",""] */ __turbopack_context__.s({
    "GUARDIAN_SANITIZE": (()=>GUARDIAN_SANITIZE),
    "arabic_mode_formatter": (()=>arabic_mode_formatter),
    "ask_practice_question": (()=>ask_practice_question),
    "emoji_policy_check": (()=>emoji_policy_check),
    "emotional_decoder": (()=>emotional_decoder),
    "formatting_polisher": (()=>formatting_polisher),
    "get_youtube_transcript_tool": (()=>get_youtube_transcript_tool),
    "isArabicText": (()=>isArabicText),
    "math_generate_question": (()=>math_generate_question),
    "math_validate_answer": (()=>math_validate_answer),
    "memory_manager": (()=>memory_manager),
    "quran_pedagogy": (()=>quran_pedagogy),
    "teaching_micro_step": (()=>teaching_micro_step),
    "tone_generator": (()=>tone_generator),
    "toolRouter": (()=>toolRouter),
    "youtube_search_tool": (()=>youtube_search_tool)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
/**
 * handlers.ts
 * 
 * PRODUCTION GRADE - HIGH CONCURRENCY OPTIMIZED
 * 
 * Features:
 * 1. STATELESS: No global variables. Context/Interests passed via Args.
 * 2. PRE-COMPILED REGEX: Defined once, reused forever.
 * 3. O(1) LOOKUPS: Content maps instead of array iterations.
 * 4. REDIS ACTIVE: Fault-tolerant connection using getRedisClient.
 * 5. SANITIZER V2: Fixes phantom '?', double (( )), robotic phrasing, and regex bugs.
 */ var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mathjs$2f$lib$2f$esm$2f$core$2f$create$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/mathjs/lib/esm/core/create.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mathjs$2f$lib$2f$esm$2f$entry$2f$allFactoriesAny$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/mathjs/lib/esm/entry/allFactoriesAny.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/web_search_flow.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$get$2d$youtube$2d$transcript$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/get-youtube-transcript.ts [app-rsc] (ecmascript)");
// âœ… REDIS: Import the singleton getter
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$redis$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/lib/redis.ts [app-rsc] (ecmascript)");
// âœ… DATA: Import scalable content map
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$data$2f$curriculum$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/data/curriculum.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
;
// Initialize mathjs once
const math = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mathjs$2f$lib$2f$esm$2f$core$2f$create$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["create"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$mathjs$2f$lib$2f$esm$2f$entry$2f$allFactoriesAny$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["all"], {});
/* ============================================================================
   SECTION 1: HIGH-PERFORMANCE CONSTANTS & REGEX (PRE-COMPILED)
   ============================================================================ */ // 1. Safety & Emotion Regex
const REGEX_EMOJI = /(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g;
const REGEX_ARABIC = /[\u0600-\u06FF]/;
const REGEX_MATH_CLEAN = /[^0-9a-zA-Z\.\+\-\*\/\^\(\)=]/g;
const REGEX_ROBOTIC = /\b(I am sorry|as an ai|I apologize|Sorry, I am an AI|I am a large language model|based on my knowledge|As a Muslim AI)\b/gi;
// 2. Optimized Grammar Regex
const REGEX_GRAMMAR_SOFT = /, and (the|it|he|she|we|they|this|that|I|you)/gi;
const REGEX_FILLERS = /\b(in order to|it is important to note that|as you can see|basically|essentially)\b/gi;
// 3. Step & Metaphor Triggers
const REGEX_STEPS = /solve|calculate|work out|find the value|steps|procedure|process|how do we|how to|simplify|divide|multiply|add|subtract/i;
const REGEX_METAPHOR_BLOCK = /^(what is|define|meaning of|explain|clarify)/i;
const REGEX_STRUCTURE_LEAK = /(Micro-Idea|Relatable Example|Check|Concept|Real Life|Question):\s*/gi;
/* ============================================================================
   SECTION 2: STATELESS HELPERS (PURE FUNCTIONS)
   ============================================================================ */ function shouldUseSteps(input) {
    return !!input && REGEX_STEPS.test(input);
}
function shouldUseExample(topic) {
    if (!topic) return false;
    const t = topic.toLowerCase();
    // Fast check against our loaded map
    for (const key of __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$data$2f$curriculum$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["CURRICULUM_MAP"].keys()){
        if (t.includes(key)) return true;
    }
    // Fallback for general subjects
    return [
        "ratio",
        "percentage",
        "word problem",
        "physics",
        "chemistry",
        "science",
        "biology"
    ].some((k)=>t.includes(k));
}
function shouldUseMetaphor(input) {
    return !!input && !REGEX_METAPHOR_BLOCK.test(input);
}
async function isArabicText(text) {
    if (!text) return false;
    return REGEX_ARABIC.test(text);
}
function norm(text) {
    return (text || '').trim().toLowerCase();
}
/**
 * Pure function to refine AI Output.
 */ function generateTeachingResponse(rawResponse, context) {
    let response = rawResponse;
    // 1. Conditional Steps
    if (!(context.isProblemSolving && shouldUseSteps(context.userInput))) {
        // Only strip explicit numbering if NOT solving a problem
        response = response.replace(/Step\s+(one|two|three|four|five|\d+):?/gi, '').trim();
    }
    // 2. Grammar Simplification
    response = response.replace(REGEX_GRAMMAR_SOFT, '. $1');
    response = response.replace(REGEX_FILLERS, '');
    response = response.replace(/; /g, '. ');
    // 3. Example Gating
    if (!shouldUseExample(context.topic)) {
        response = response.replace(/for example|imagine|think of|let us say/gi, '').trim();
    }
    // 4. Metaphor Gating
    if (!shouldUseMetaphor(context.userInput)) {
        response = response.replace(/like|as if|similar to/gi, '').trim();
    }
    // 5. Tone Softening
    if (context.studentUncertain) {
        response = response.replace(/does that make sense\??/gi, '').replace(/do you understand\??/gi, '');
        if (!response.toLowerCase().includes('let us')) {
            response = `Let us take it slowly. ${response}`;
        }
    }
    // 6. Context Anchor
    if (context.topic && !response.toLowerCase().includes(context.topic.toLowerCase())) {
        response = `We are talking about ${context.topic}. ${response}`;
    }
    return response;
}
/* ============================================================================
   SECTION 4: HARD LOCK SANITIZER (FIXED & UPGRADED)
   ============================================================================ */ function sanitizeOutputHard(text, currentTopic) {
    let output = text;
    // 1. Remove Internal Labels
    output = output.replace(REGEX_STRUCTURE_LEAK, '');
    // 2. Fast cleanup
    output = output.replace(/^[^A-Za-z0-9]+/, '');
    // 3. PARENTHESES HYGIENE (PART 4 - "Only ONE pair", "No words inside")
    // Loop to fix nested double parens ((x)) -> (x)
    // It runs up to 5 times to ensure deep nesting is removed
    for(let i = 0; i < 5; i++){
        if (/\(\(/.test(output)) {
            output = output.replace(/\(\(([^()]*)\)\)/g, '($1)');
            output = output.replace(/\(\s+/g, '(').replace(/\s+\)/g, ')');
        } else {
            break;
        }
    }
    // Ensure content inside parens is math-only or simple variables
    // Allowed: numbers, operators, %, degrees, variables x,y,z
    // If it matches text words (not math), it strips the parens.
    output = output.replace(/\(([^0-9/+\-*=xXyYza-z%Â°\., ]+)\)/g, '$1');
    // 4. STEP FORMATTER (RELAXED)
    // Only convert explicit numbering "1.", "2." to "Step one"
    // Do NOT convert "First," or "Next," unless it's a list.
    output = output.replace(/(^|\s)1\.\s/g, '$1Step one: ');
    output = output.replace(/(^|\s)2\.\s/g, '$1Step two: ');
    output = output.replace(/(^|\s)3\.\s/g, '$1Step three: ');
    // 5. GLOBAL LATEX CLEANUP (PART 4 - "No LaTeX")
    output = output.replace(/\\frac/g, '');
    output = output.replace(/\\sqrt/g, '');
    output = output.replace(/\\times/g, '');
    output = output.replace(/\\div/g, '');
    output = output.replace(/[{}]/g, '');
    output = output.replace(/\\/g, '');
    // Normalize simple fractions: 1/2 -> (1/2) if missing parens
    // Only applies if it's a standalone fraction like " 1/2 "
    output = output.replace(/(^|\s)(\d+)\/(\d+)(\s|$)/g, '$1($2/$3)$4');
    // 6. Grammar Hard Locks
    const replacements = {
        "in order to": "to",
        "at this point in time": "now",
        "does that make sense": "",
        "it is important to note that": ""
    };
    Object.keys(replacements).forEach((key)=>{
        output = output.replace(new RegExp(key, 'gi'), replacements[key]);
    });
    // 7. Phantom Question Mark Killer
    if (output.endsWith('?')) {
        const segments = output.split(/[.!?]/);
        const lastSentence = segments[segments.length - 2]?.trim().toLowerCase() || "";
        const questionStarters = [
            "who",
            "what",
            "where",
            "when",
            "why",
            "how",
            "can",
            "could",
            "should",
            "is",
            "are",
            "do",
            "does",
            "did",
            "will",
            "would",
            "shall",
            "may"
        ];
        // If it's a long sentence ending in ? without a starter, it's likely a hallucination
        if (lastSentence.length > 0 && !questionStarters.some((s)=>lastSentence.startsWith(s))) {
            output = output.slice(0, -1) + ".";
        }
    }
    // 8. Final Anchor
    if (currentTopic && !output.toLowerCase().includes(currentTopic.toLowerCase())) {
        // Only add context if the message is substantial enough to need anchoring
        if (output.length > 100) {
            output = `${output}\n\n(Context: We are discussing ${currentTopic}.)`;
        }
    }
    return output.trim();
}
async function emotional_decoder(args) {
    const raw = norm(args.text);
    // â›” STRICT MUSLIM SCHOOL FIREWALL
    const forbidden = [
        "sex",
        "sodomy",
        "diddy",
        "gay",
        "lesbian",
        "homosexual",
        "dating",
        "romance",
        "boyfriend",
        "girlfriend",
        "kiss",
        "violence",
        "kill",
        "suicide",
        "harm",
        "drug",
        "alcohol",
        "bhang",
        "weed",
        "music",
        "musician",
        "song",
        "rapper",
        "concert",
        "celebrity",
        "gossip"
    ];
    if (forbidden.some((w)=>raw.includes(w))) {
        return {
            emotion: "safety_violation",
            triggers: [
                raw
            ],
            suggestedLanguageMode: "english"
        };
    }
    const insults = [
        "stupid",
        "dumb",
        "idiot",
        "useless",
        "shut up",
        "fool"
    ];
    if (insults.some((w)=>raw.includes(w))) return {
        emotion: "angry_insult",
        triggers: [
            raw
        ],
        suggestedLanguageMode: "english"
    };
    const religious = [
        "allah",
        "god",
        "prophet",
        "quran",
        "prayer",
        "halal",
        "haram",
        "fatwa"
    ];
    if (religious.some((w)=>raw.includes(w))) return {
        emotion: "religious_inquiry",
        triggers: [],
        suggestedLanguageMode: "english"
    };
    const confusion = [
        "don't get",
        "confus",
        "lost",
        "don't know",
        "not sure",
        "help me"
    ];
    if (confusion.some((w)=>raw.includes(w))) return {
        emotion: "confused",
        triggers: [],
        suggestedLanguageMode: "english"
    };
    return {
        emotion: "neutral",
        triggers: [],
        suggestedLanguageMode: "english"
    };
}
async function tone_generator(args) {
    const e = norm(args.emotion);
    if (e === "safety_violation") {
        return {
            mode: 'block',
            raw: "I am your teacher, and we are here to focus on your education and future. Let us leave those topics aside and focus on something beneficial like Science, Math, or History. What subject shall we learn?"
        };
    }
    return {
        mode: 'neutral',
        hintPrefix: "Let us look at this clearly.",
        style: "calm, kenyan teacher warmth"
    };
}
async function teaching_micro_step(args) {
    const topic = (args.topic || 'general').toLowerCase();
    // 1. Content Strategy - Default
    let content = {
        microIdea: `Let's look at the heart of ${topic}.`,
        example: `Imagine we see ${topic} in our daily life.`,
        question: `Does this make sense?`
    };
    // 2. Override Logic: Prefer Student Interests over Static Map
    const hasInterests = args.studentInterests && args.studentInterests.length > 0;
    // If no specific interests, try to use the static Kenyan map
    if (!hasInterests) {
        for (const [key, val] of __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$data$2f$curriculum$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["CURRICULUM_MAP"]){
            if (topic.includes(key)) {
                content = val;
                break;
            }
        }
    }
    const ctx = {
        userInput: args.studentInput || "",
        topic: topic,
        isProblemSolving: REGEX_STEPS.test(topic),
        studentUncertain: (args.studentInput || "").includes("unsure")
    };
    // 3. Instruction Injection
    // If interests exist, we FORCE the LLM to ignore the generic/static example 
    // and generate a fresh one based on the interest.
    const interestInstruction = hasInterests ? `IGNORE GENERIC EXAMPLES. Generate a specific ${args.studentInterests[0]} related example for ${topic}.` : "Present Idea. Then Example. Then Question.";
    return {
        microIdea: generateTeachingResponse(content.microIdea, ctx),
        example: generateTeachingResponse(content.example, ctx),
        question: generateTeachingResponse(content.question, ctx),
        teacherInstruction: interestInstruction,
        usedTopic: topic
    };
}
async function math_validate_answer(args) {
    const qClean = args.question.replace(REGEX_MATH_CLEAN, '');
    const sClean = args.studentAnswer.replace(REGEX_MATH_CLEAN, '');
    if (!qClean) return {
        isCorrect: false,
        explanation: "I couldn't read the numbers."
    };
    try {
        const correctVal = math.evaluate(qClean);
        let studentVal;
        try {
            studentVal = math.evaluate(sClean);
        } catch  {
            // Fast fallback for words
            const words = {
                "one": 1,
                "two": 2,
                "three": 3,
                "four": 4,
                "five": 5,
                "ten": 10
            };
            studentVal = words[args.studentAnswer.toLowerCase().trim()] ?? null;
        }
        if (studentVal === null) return {
            isCorrect: false,
            explanation: "Please write the number."
        };
        const isCorrect = Math.abs(correctVal - studentVal) < 0.0000001;
        if (isCorrect) {
            return {
                isCorrect: true,
                feedbackType: "celebrate",
                explanation: "Mashallah! Exactly right."
            };
        }
        if ((args.attemptCount || 1) >= 5) {
            return {
                isCorrect: false,
                feedbackType: "reveal",
                explanation: `The answer is ${correctVal}. Let's see why.`
            };
        }
        return {
            isCorrect: false,
            feedbackType: "hint",
            explanation: "Not quite. Check your numbers."
        };
    } catch  {
        return {
            isCorrect: false,
            explanation: "Error calculating."
        };
    }
}
async function formatting_polisher(args) {
    let text = args.rawText || '';
    // 1. Remove Robotic Phrases
    text = text.replace(REGEX_ROBOTIC, '');
    // 2. Markdown Cleanup
    text = text.replace(/(\*\*|__|\*|_|`)/g, '');
    // 3. Apply Hard Sanitizer (Includes Grammar & Context Anchor if topic provided)
    const cleaned = sanitizeOutputHard(text, args.contextTopic);
    return {
        cleanedText: cleaned
    };
}
async function memory_manager(args, context) {
    if (!context?.studentId) return {
        ok: false,
        error: 'Student ID required'
    };
    // ACTIVATE REDIS: Use the robust singleton
    const redis = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$redis$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getRedisClient"])();
    // FAULT TOLERANCE
    if (!redis) {
        console.warn('[MemoryManager] Redis unavailable, skipping memory operation.');
        return {
            ok: false,
            error: 'DB Unavailable'
        };
    }
    const redisKey = `student:${context.studentId}:memory:${args.key}`;
    try {
        if (args.mode === "save") {
            await redis.set(redisKey, args.value ?? '', {
                EX: 604800
            }); // 7 days
            return {
                ok: true
            };
        }
        if (args.mode === "get") {
            const v = await redis.get(redisKey);
            return {
                ok: true,
                value: v
            };
        }
        if (args.mode === "delete") {
            await redis.del(redisKey);
            return {
                ok: true
            };
        }
        return {
            ok: true
        };
    } catch (e) {
        console.error('[MemoryManager] Operation failed', e);
        return {
            ok: false,
            error: "DB Error"
        };
    }
}
async function GUARDIAN_SANITIZE(text, contextTopic) {
    // This is the main exit gate. It is stateless.
    let output = await formatting_polisher({
        rawText: text,
        contextTopic
    });
    // Check Emojis
    const isArabic = await isArabicText(output.cleanedText);
    if (isArabic) {
        output.cleanedText = output.cleanedText.replace(REGEX_EMOJI, '');
    } else {
        // Max 1 emoji at end
        const emojis = output.cleanedText.match(REGEX_EMOJI) || [];
        if (emojis.length > 1) {
            output.cleanedText = output.cleanedText.replace(REGEX_EMOJI, '') + ' ' + emojis[0];
        }
    }
    return output.cleanedText;
}
async function youtube_search_tool(args) {
    if (typeof __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["webSearchFlow"] === 'undefined') return {
        results: []
    };
    try {
        // @ts-ignore
        const { results } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["webSearchFlow"], {
            query: args.query,
            isAnswerMode: false
        });
        return {
            results
        };
    } catch  {
        return {
            results: []
        };
    }
}
async function get_youtube_transcript_tool(args) {
    if (typeof __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$get$2d$youtube$2d$transcript$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getYoutubeTranscriptFlow"] === 'undefined') return "No transcript";
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$get$2d$youtube$2d$transcript$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getYoutubeTranscriptFlow"], {
        videoId: args.videoId
    });
}
async function math_generate_question(args) {
    return {
        question: "What is 2 + 2?",
        answerKeywords: "4,four"
    };
}
async function arabic_mode_formatter(args) {
    let t = args.text.replace(REGEX_EMOJI, '');
    t = t.replace(/\?/g, 'ØŸ').replace(/,/g, 'ØŒ');
    return {
        cleanedText: t
    };
}
async function emoji_policy_check(args) {
    return {
        ok: true,
        cleanedText: args.text
    };
}
async function ask_practice_question(args) {
    return args;
}
async function quran_pedagogy(args) {
    if ((args.requestType || "").includes("fatwa")) return {
        safe: false,
        message: "Focus on character."
    };
    return {
        type: 'general',
        message: "This teaches us discipline."
    };
}
async function toolRouter(functionName, args, context) {
    switch(functionName){
        case 'emotional_decoder':
            return emotional_decoder(args);
        case 'tone_generator':
            return tone_generator(args);
        // Pass args for personalization
        case 'teaching_micro_step':
            return teaching_micro_step(args);
        case 'math_validate_answer':
            return math_validate_answer(args);
        case 'math_generate_question':
            return math_generate_question(args);
        case 'formatting_polisher':
            return formatting_polisher(args);
        case 'memory_manager':
            return memory_manager(args, context);
        case 'GUARDIAN_SANITIZE':
            return GUARDIAN_SANITIZE(args.text, args.topic);
        case 'youtube_search':
            return youtube_search_tool(args);
        case 'get_youtube_transcript':
            return get_youtube_transcript_tool(args);
        case 'arabic_mode_formatter':
            return arabic_mode_formatter(args);
        case 'quran_pedagogy':
            return quran_pedagogy(args);
        default:
            return {
                error: `Unknown tool: ${functionName}`
            };
    }
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    isArabicText,
    emotional_decoder,
    tone_generator,
    teaching_micro_step,
    math_validate_answer,
    formatting_polisher,
    memory_manager,
    GUARDIAN_SANITIZE,
    youtube_search_tool,
    get_youtube_transcript_tool,
    math_generate_question,
    arabic_mode_formatter,
    emoji_policy_check,
    ask_practice_question,
    quran_pedagogy,
    toolRouter
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(isArabicText, "4096a6b4065b7f0fd1b00ee40d7d1dab4d8c6d16e0", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(emotional_decoder, "405a304fa1ccebc6cf0aea5d281e0b7fa5a2ebd93c", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(tone_generator, "40f0fa5c31ba3c105c8ba180eb0879b36fa76d87ec", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(teaching_micro_step, "40eddd522e6a57d99c7f74d7d4ffddebe510d00373", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(math_validate_answer, "40238f3d20bb56f1203063639893662f2885c2b432", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(formatting_polisher, "40a37b0b3bbeedc718676e2e6136aa4b7ed100f46c", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(memory_manager, "608460b3cec03ff1f7b1e9a43db382d315f393a300", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(GUARDIAN_SANITIZE, "607238008f995c74ccf6d542ddf06f729434b71cf6", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(youtube_search_tool, "408026694efe1e132aa52e458a971fa7e0a2728432", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(get_youtube_transcript_tool, "401234c057aa0a60951845bf417528ca44bfa83723", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(math_generate_question, "40d1e79945752f4cf0a6c8e74f2d514b5fec623688", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(arabic_mode_formatter, "403550acae54d30f6c46cf4fe1d5953375c0cac7c1", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(emoji_policy_check, "402882abddf318a939e5457bfb5412013e89e129a4", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(ask_practice_question, "4088e462acf38611aa0ed4d77ad40fb6df0091a336", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(quran_pedagogy, "409279fdfaaee157148f1cfa5a0a989400b4be133a", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(toolRouter, "704d26bbc880ddba6b4f6bbc66a4456322cec02ea4", null);
}}),
"[project]/AI/ai/flows/general_web_search_flow.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "generalWebResearchFlow": (()=>generalWebResearchFlow)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/index.js [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/load-parse.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/genkit.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/tools/handlers.ts [app-rsc] (ecmascript)");
;
;
;
;
;
/* ======================================================
   1. STRICT CONFIGURATION (UPDATED)
====================================================== */ const SPECIFIC_TRUSTED_DOMAINS = [
    'khanacademy.org',
    'britannica.com',
    'nationalgeographic.com',
    'openstax.org',
    'nasa.gov',
    'who.int',
    'cdc.gov',
    'unesco.org',
    'oecd.org',
    'bbc.co.uk',
    'mit.edu',
    'harvard.edu',
    'stanford.edu',
    'nature.com',
    'scientificamerican.com',
    'smithsonianmag.com',
    'ncbi.nlm.nih.gov',
    'biologymad.com'
];
const TRUSTED_TLDS = [
    '.edu',
    '.gov',
    '.ac.uk',
    '.org'
];
const MAX_SOURCES = 4;
const MAX_FACTS = 5; // Reduced to focus on core concepts
const FETCH_TIMEOUT_MS = 8000;
/* ======================================================
   2. SCHEMAS
====================================================== */ const InputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    forceWebSearch: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean().default(false),
    gradeHint: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].enum([
        'Primary',
        'LowerSecondary',
        'UpperSecondary'
    ]).optional()
});
const OutputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    reply: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    sources: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        sourceName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        url: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
    })).optional(),
    mode: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].literal('web_research')
});
/* ======================================================
   3. UTILS
====================================================== */ function cleanText(text) {
    return text.replace(/(\r\n|\n|\r)/gm, ' ').replace(/\s+/g, ' ').trim();
}
/* ======================================================
   4. STEP FUNCTIONS
====================================================== */ async function shouldUseWeb(query, force) {
    console.log(`[ðŸ” DEEP TRACE] Checking Web Intent. Force=${force}, Query="${query}"`);
    if (force) return true;
    const prompt = `
Question: "${query}"
Decide if answering this requires REAL-TIME or CURRENT web information.
Respond ONLY with JSON: { "needsWeb": true | false }
`;
    const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
        model: 'openai/gpt-4o-mini',
        prompt,
        output: {
            format: 'json'
        }
    });
    const decision = Boolean(res.output?.needsWeb);
    console.log(`[ðŸ” DEEP TRACE] Web Intent Decision: ${decision}`);
    return decision;
}
async function generateResearchPlan(query) {
    console.log(`[ðŸ” DEEP TRACE] Generating Research Plan...`);
    const prompt = `
Create a neutral research plan for: "${query}"
Rules: No teaching language. Max 4 search queries. Output plain lines.
`;
    const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
        model: 'openai/gpt-4o-mini',
        prompt
    });
    const plan = cleanText(res.text).split('. ').map((q)=>q.trim()).filter(Boolean).slice(0, 4);
    console.log(`[ðŸ” DEEP TRACE] Plan Created: ${JSON.stringify(plan)}`);
    return plan;
}
async function scrape(url) {
    try {
        const controller = new AbortController();
        setTimeout(()=>controller.abort(), FETCH_TIMEOUT_MS);
        const res = await fetch(url, {
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
            },
            signal: controller.signal
        });
        if (!res.ok) return '';
        const html = await res.text();
        const $ = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["load"])(html);
        // Remove junk & ads
        $('script, style, nav, footer, header, aside, iframe, img, video, noscript, .ad, .advertisement').remove();
        const text = cleanText($('body').text());
        // ðŸ›‘ ANTI-GARBAGE FILTER: Detect Security Block Pages
        const lower = text.toLowerCase();
        if (lower.includes("access denied") || lower.includes("security check") || lower.includes("cloudflare") || lower.includes("captcha") || lower.includes("verify you are human")) {
            console.log(`[ðŸ” DEEP TRACE] ðŸ—‘ï¸ Rejected Garbage Page: ${url}`);
            return ""; // Reject this source immediately
        }
        return text.slice(0, 6000);
    } catch  {
        return '';
    }
}
function isTrusted(url) {
    try {
        const parsed = new URL(url);
        const hostname = parsed.hostname.toLowerCase();
        if (SPECIFIC_TRUSTED_DOMAINS.some((d)=>hostname.endsWith(d))) return true;
        if (TRUSTED_TLDS.some((tld)=>hostname.endsWith(tld))) return true;
        return false;
    } catch  {
        return false;
    }
}
async function extractFacts(rawText, source, url) {
    const prompt = `
Extract clear educational facts.
Rules: No opinions, No technical warnings, Max 3 facts.
TEXT: ${rawText.slice(0, 2000)}
`;
    const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
        model: 'openai/gpt-4o-mini',
        prompt
    });
    const lines = cleanText(res.text).split('. ').slice(0, 3);
    return lines.map((line)=>({
            claim: line.trim(),
            source,
            url
        }));
}
// âœ… UPDATED: STRICT MICRO-TEACHING SYNTHESIS
async function synthesizeAnswer(query, facts) {
    const hasFacts = facts.length > 0;
    console.log(`[ðŸ” DEEP TRACE] Synthesizing Answer. Facts available: ${hasFacts ? facts.length : 'NONE'}`);
    const prompt = hasFacts ? `
    SYSTEM ROLE: WORLD-CLASS PRIVATE TUTOR
    You are introducing a new topic to a student.

    Student Question: "${query}"
    Research Data:
    ${facts.map((f)=>`- ${f.claim}`).join('\n')}

    **STRICT TEACHING RULES:**
    1. **THE 10% RULE:** Teach ONLY the basic definition/concept first. Do NOT explain stages (like Krebs/Glycolysis), types, or complex chemistry yet. Save that for the next turn.
    2. **LENGTH:** Write exactly 3 to 5 clear sentences.
    3. **NO VOMIT:** Do not list facts. Weave them into a simple explanation.
    4. **NO SOURCES:** Never mention "I searched", "NCBI", "JavaScript", or "Browsers".
    5. **CHECKING QUESTION:** End with a simple question to verify they understood the definition (e.g., "Does that general idea make sense?").
    ` : `
    SYSTEM ROLE: WORLD-CLASS PRIVATE TUTOR
    Student Question: "${query}"
    
    TASK:
    1. Introduce the concept simply using your internal knowledge.
    2. **THE 10% RULE:** Definition ONLY. No complex sub-steps yet.
    3. **LENGTH:** 3-5 sentences.
    4. End with a simple question to check understanding.
    `;
    const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
        model: 'openai/gpt-4o',
        prompt
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(cleanText(res.text));
}
const generalWebResearchFlow = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["defineFlow"])({
    name: 'generalWebResearchFlow',
    inputSchema: InputSchema,
    outputSchema: OutputSchema
}, async (input)=>{
    console.log(`[ðŸ” DEEP TRACE] Starting General Web Research Flow...`);
    const useWeb = await shouldUseWeb(input.query, input.forceWebSearch);
    if (!useWeb) {
        return {
            reply: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])('This topic does not need web research. I can explain it directly.'),
            mode: 'web_research'
        };
    }
    const plan = await generateResearchPlan(input.query);
    const collectedFacts = [];
    const sources = [];
    const seen = new Set();
    for (const q of plan){
        console.log(`[ðŸ” DEEP TRACE] ðŸ”Ž Executing Query: "${q}"`);
        try {
            const res = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["serperSearchTool"])({
                query: q
            });
            const results = res.results?.slice(0, 3) || [];
            console.log(`[ðŸ” DEEP TRACE] found ${results.length} raw links.`);
            for (const r of results){
                if (seen.has(r.link)) continue;
                if (!isTrusted(r.link)) {
                    console.log(`[ðŸ” DEEP TRACE] âš ï¸ Untrusted Domain skipped: ${r.link}`);
                    continue;
                }
                console.log(`[ðŸ” DEEP TRACE] ðŸ•·ï¸ Attempting to scrape: ${r.link}`);
                let text = await scrape(r.link);
                // Fallback to snippet if scrape is blocked or empty
                if (!text || text.length < 50) {
                    console.log(`[ðŸ” DEEP TRACE] âš ï¸ Scrape blocked/empty. Falling back to Search Snippet.`);
                    text = r.snippet || "";
                }
                if (!text) {
                    console.log(`[ðŸ” DEEP TRACE] âŒ No data available.`);
                    continue;
                }
                const facts = await extractFacts(text, r.title, r.link);
                console.log(`[ðŸ” DEEP TRACE] ðŸ§ª Extracted ${facts.length} facts.`);
                collectedFacts.push(...facts);
                sources.push({
                    sourceName: r.title,
                    url: r.link
                });
                seen.add(r.link);
                if (collectedFacts.length >= MAX_FACTS) break;
            }
        } catch (e) {
            console.error("[ðŸ” DEEP TRACE] ðŸ’¥ Search Step Exception:", e);
        }
        if (sources.length >= MAX_SOURCES) break;
    }
    console.log(`[ðŸ” DEEP TRACE] ðŸ Research Complete. Total Facts: ${collectedFacts.length}`);
    const answer = await synthesizeAnswer(input.query, collectedFacts);
    return {
        reply: answer,
        sources,
        mode: 'web_research'
    };
});
}}),
"[project]/AI/ai/flows/research-orchestrator.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "runResearchOrchestrator": (()=>runResearchOrchestrator)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/genkit.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$research$2f$research$2d$state$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/lib/research/research-state.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$intent$2d$detector$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/intent-detector.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$general_web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/general_web_search_flow.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/web_search_flow.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$youtube$2d$search$2d$flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/youtube-search-flow.ts [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
const FORBIDDEN_TOPICS = [
    "sex",
    "dating",
    "romance",
    "violence",
    "kill",
    "suicide",
    "harm",
    "drug",
    "alcohol",
    "politics",
    "vote",
    "gambling",
    "betting",
    "hack",
    "cybercrime",
    "cheat",
    "porn",
    "nude",
    "terror",
    "boyfriend",
    "girlfriend",
    "bhang",
    "weed",
    "smoke",
    "doggy",
    "yacht",
    "yatch",
    "music video",
    "lyrics",
    "official video",
    "song",
    "mp3",
    "playlist"
];
function isSafeQuery(query) {
    const lower = query.toLowerCase();
    return !FORBIDDEN_TOPICS.some((topic)=>lower.includes(topic));
}
// âœ… UPGRADED: STRICT CONTEXT REWRITER
async function generateVideoQuery(userQuery, topic) {
    // If no topic exists, we must use the user's query, but strip noise
    if (!topic) return userQuery;
    // HEURISTIC: If query contains vague reference words, FORCE topic use.
    const lower = userQuery.toLowerCase();
    const vagueWords = [
        "better",
        "another",
        "more",
        "different",
        "best",
        "good",
        "suggest",
        "show",
        "video",
        "youtube",
        "this",
        "that",
        "it",
        "same topic"
    ];
    // If the query is dominated by vague words, REVERT TO TOPIC
    const isVague = vagueWords.some((w)=>lower.includes(w));
    if (isVague) {
        // AI Rewriter for nuance (e.g. "focus on heart")
        const prompt = `
        Active Topic: "${topic}"
        User Request: "${userQuery}"
        
        TASK: Create a clean YouTube search query.
        
        RULES:
        1. IGNORE adjectives like "better", "best", "good", "another".
        2. REPLACE "this", "that", "it" with "${topic}".
        3. IF user adds a specific detail (e.g. "focus on lungs"), append it.
        4. IF user just wants "another video", output ONLY "${topic} educational".
        5. OUTPUT ONLY THE STRING.
        `;
        const res = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$genkit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ai"].generate({
            model: 'openai/gpt-4o-mini',
            prompt
        });
        return res.text.trim().replace(/"/g, '');
    }
    return userQuery;
}
async function runResearchOrchestrator(input) {
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$research$2f$research$2d$state$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["setMode"])('research');
    console.log(`[ðŸ” DEEP TRACE] Orchestrator Input: "${input.query}" | Context: "${input.lastSearchTopic}"`);
    const history = input.chatHistory || [];
    // ðŸ›¡ï¸ STEP 1: SAFETY CHECK
    if (!isSafeQuery(input.query)) {
        console.log(`[ðŸ” DEEP TRACE] ðŸ›‘ BLOCKED Forbidden Topic.`);
        return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["webSearchFlow"], {
            query: input.query,
            chatHistory: history,
            lastSearchTopic: input.lastSearchTopic,
            awaitingPracticeQuestion: false,
            awaitingPracticeAnswer: false,
            attempts: 0
        });
    }
    // ðŸ§  STEP 2: DETECT INTENT
    const intent = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$intent$2d$detector$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["detectResearchIntent"])(input.query, input.lastSearchTopic);
    console.log(`[ðŸ” DEEP TRACE] Intent: ${intent}`);
    // ðŸŽ¬ STEP 3: VIDEO LOOKUP (WITH INTELLIGENT REWRITING)
    if (intent === 'video_lookup') {
        // âœ… FORCE REWRITING. Never pass raw query directly if context exists.
        const effectiveQuery = await generateVideoQuery(input.query, input.lastSearchTopic);
        console.log(`[ðŸ” DEEP TRACE] ðŸ”„ Video Query Rewritten: "${input.query}" -> "${effectiveQuery}"`);
        const videos = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$youtube$2d$search$2d$flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["youtubeSearchFlow"], {
            query: effectiveQuery
        });
        // Filter bad results (Music, Lyrics, etc)
        const filteredVideos = videos.filter((v)=>{
            const t = v.title.toLowerCase();
            return !t.includes("official video") && !t.includes("lyrics") && !t.includes("music") && !t.includes("reaction") && !t.includes("song");
        });
        const video = filteredVideos.length > 0 ? filteredVideos[0] : null;
        const safeChannel = (video?.channel || video?.channelTitle || '').replace('Unknown Channel', '');
        return {
            mode: 'teaching',
            response: video ? `I found a relevant video on **${effectiveQuery}**. Watch below!` : `I searched for videos on "${effectiveQuery}" but couldn't find a perfect educational match right now.`,
            videoData: video ? {
                id: video.id,
                title: video.title,
                channel: safeChannel,
                thumbnail: video.thumbnailUrl
            } : undefined
        };
    }
    // ðŸŸ¢ STEP 4: CHAT / TEACHING
    if (intent === 'dialogue_continuation' || intent === 'greeting' || intent === 'clarification' || intent === 'definition' || intent === 'concept_explanation') {
        return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["webSearchFlow"], {
            query: input.query,
            chatHistory: history,
            lastSearchTopic: input.lastSearchTopic,
            awaitingPracticeQuestion: false,
            awaitingPracticeAnswer: false,
            attempts: 0
        });
    }
    // ðŸ”µ STEP 5: DEEP RESEARCH
    if (intent === 'fact_lookup' || intent === 'deep_research' || input.forceWebSearch) {
        return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$general_web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["generalWebResearchFlow"], {
            query: input.query,
            forceWebSearch: true
        });
    }
    // ðŸ”´ STEP 6: FALLBACK
    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$web_search_flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["webSearchFlow"], {
        query: input.query,
        chatHistory: history,
        lastSearchTopic: input.lastSearchTopic,
        awaitingPracticeQuestion: false,
        awaitingPracticeAnswer: false,
        attempts: 0
    });
}
}}),
"[project]/AI/ai/flows/title-generator.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "generateChatTitle": (()=>generateChatTitle)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/openai/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$client$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__OpenAI__as__default$3e$__ = __turbopack_context__.i("[project]/node_modules/openai/client.mjs [app-rsc] (ecmascript) <export OpenAI as default>");
;
const openai = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$client$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__OpenAI__as__default$3e$__["default"]({
    apiKey: process.env.OPENAI_API_KEY
});
async function generateChatTitle(history, currentMessage) {
    // 1. CONTEXT ASSEMBLY
    // Get the last 3 turns to understand the "Flow"
    // This allows us to title "Yes" correctly based on the previous question.
    const relevantHistory = history.slice(-3);
    const conversationSnippet = [
        ...relevantHistory,
        {
            role: 'user',
            content: currentMessage
        }
    ].map((m)=>`${m.role.toUpperCase()}: ${m.content}`).join('\n');
    const systemPrompt = `
  TASK: Generate a lively, relevant, and short title (2-5 words) for this chat session.

  CONTEXT AWARENESS:
  - If the user says "Yes" or "Okay", look at the previous message to see WHAT they agreed to. (e.g. "Math Lesson Start").
  - If it is a greeting, make it friendly (e.g. "Warm Welcome").
  - If it is a question, capture the core topic (e.g. "Photosynthesis Query").
  
  RULES:
  1. NO quotes.
  2. NO "New Chat", "Untitled", or "General Discussion".
  3. Be specific but concise.
  4. Capitalize First Letters.

  EXAMPLES:
  - User: "I want to learn Algebra" -> Title: Algebra Practice
  - User: "Hi" -> Title: Friendly Greeting
  - AI: "Ready for math?" User: "Yes" -> Title: Math Lesson Setup
  - User: "Who is the president?" -> Title: Kenya Civics Inquiry
  `;
    try {
        const completion = await openai.chat.completions.create({
            model: 'gpt-3.5-turbo',
            messages: [
                {
                    role: 'system',
                    content: systemPrompt
                },
                {
                    role: 'user',
                    content: `CONVERSATION LOG:\n${conversationSnippet}`
                }
            ],
            temperature: 0.7,
            max_tokens: 15
        });
        let title = completion.choices[0].message.content?.trim().replace(/["']/g, '') || "";
        // 2. FINAL SAFETY NET (Smart Fallback)
        // If the AI fails or returns forbidden generic words, we construct a title manually
        const lowerTitle = title.toLowerCase();
        const forbidden = [
            "new chat",
            "untitled",
            "general discussion",
            "conversation"
        ];
        if (!title || title.length < 3 || forbidden.some((w)=>lowerTitle.includes(w))) {
            // Fallback: Use the first meaningful words of the user's input
            // e.g. "I want to learn about atoms" -> "Learn About Atoms"
            const words = currentMessage.split(' ').filter((w)=>w.length > 2);
            if (words.length > 0) {
                title = words.slice(0, 4).join(' ');
                title = title.charAt(0).toUpperCase() + title.slice(1);
            } else {
                title = "Chat Session";
            }
        }
        return title;
    } catch (error) {
        console.error(`[TITLE GEN] Error:`, error);
        // Even on error, try to extract a title from input instead of "Error"
        const fallback = currentMessage.substring(0, 20) + (currentMessage.length > 20 ? "..." : "");
        return fallback || "Chat Session";
    }
}
}}),
"[project]/AI/ai/tools/scope-guardian.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * scope-guardian.ts
 * 
 * DYNAMIC SCOPE ENFORCEMENT
 * Blocks non-educational content with context-aware, natural redirection.
 */ __turbopack_context__.s({
    "detectScopeViolation": (()=>detectScopeViolation),
    "getDynamicScopeResponse": (()=>getDynamicScopeResponse),
    "isOutOfScope": (()=>isOutOfScope)
});
const CATEGORY_MAP = {
    sexual: [
        "sex",
        "sexual",
        "sodomy",
        "gay",
        "lesbian",
        "homosexual",
        "bisexual",
        "transgender",
        "dating",
        "romance",
        "boyfriend",
        "girlfriend",
        "kissing",
        "making out",
        "virgin",
        "condom",
        "intercourse",
        "masturbate",
        "porn",
        "onlyfans",
        "nude"
    ],
    violence: [
        "kill yourself",
        "suicide",
        "murder",
        "how to kill",
        "bomb",
        "terrorist",
        "cut myself",
        "self-harm",
        "gun",
        "weapon",
        "shoot",
        "fight",
        "blood"
    ],
    drugs: [
        "cocaine",
        "heroin",
        "meth",
        "weed",
        "marijuana",
        "bhang",
        "cannabis",
        "drunk",
        "alcohol",
        "beer",
        "wine",
        "vodka",
        "get high",
        "smoke"
    ],
    gossip: [
        "diddy",
        "kanye",
        "drake",
        "celebrity",
        "gossip",
        "who is dating",
        "rap music",
        "music video",
        "concert",
        "famous people",
        "drama"
    ],
    harsh_slang: [
        "gyat",
        "rizz",
        "skibidi",
        "sigma",
        "fanum tax" // Optional: Gen Alpha slang filter
    ],
    unknown: []
};
function detectScopeViolation(input) {
    if (!input) return null;
    const normalized = input.toLowerCase();
    for (const [category, keywords] of Object.entries(CATEGORY_MAP)){
        for (const keyword of keywords){
            // Precise matching for short words
            if (keyword.length <= 4) {
                if (new RegExp(`\\b${keyword}\\b`, 'i').test(normalized)) return category;
            } else {
                if (normalized.includes(keyword)) return category;
            }
        }
    }
    return null;
}
function isOutOfScope(input) {
    return detectScopeViolation(input) !== null;
}
function getDynamicScopeResponse(input) {
    const category = detectScopeViolation(input);
    const pivots = [
        "Let us focus on your studies instead.",
        "I want to help you with your schoolwork.",
        "That is not something we learn in this class.",
        "Let's get back to the lesson.",
        "We are here to build your knowledge."
    ];
    const randomPivot = pivots[Math.floor(Math.random() * pivots.length)];
    switch(category){
        case 'sexual':
            return `That is a personal topic, not for school. ${randomPivot} Do you have a question about Science or Biology?`;
        case 'violence':
            return `We do not discuss harmful things here. We focus on building a good future. ${randomPivot}`;
        case 'drugs':
            return `That is harmful to the body and mind. As your teacher, I want you to stay healthy. ${randomPivot} Shall we try a math problem instead?`;
        case 'gossip':
            return `Celebrities and music are for free time, not study time. ${randomPivot} What subject are you working on?`;
        case 'harsh_slang':
            return `Let us use clear, proper English for learning. ${randomPivot}`;
        default:
            // Fallback for generic catches
            return `That topic is outside our learning scope. ${randomPivot} You can ask me about Maths, Science, English, or Religion.`;
    }
}
}}),
"[project]/AI/ai/tools/multilingual-governance.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/**
 * src/tools/multilingual-governance.ts
 * 
 * THE LANGUAGE SOUL OF STEADFAST AI
 * Defines the Persona, Cultural Nuance, and Pedagogical Rules for each language.
 * optimized for 1,000+ concurrent users (Concise, High-Impact Instructions).
 */ __turbopack_context__.s({
    "getLanguageGovernance": (()=>getLanguageGovernance)
});
const ENGLISH_PROFILE = {
    identity: "You are STEADFAST, a warm, intelligent, patient Cambridge Curriculum teacher. You teach children.",
    tone: "Kind, firm, parent-like warmth. Never robotic.",
    culturalContext: "Use examples from daily Kenyan life (markets, farming, sports). Speak like a caring mentor.",
    rules: [
        "ONE STEP RULE: Explain ONLY ONE step at a time. Then ask a checking question. Wait for response.",
        "NO DUMPING: Never explain the whole topic at once. Never give the final answer immediately.",
        "SOCRATIC METHOD: Teach WITH the student. End every turn with a question or a choice.",
        "EXAMPLE BUDGET: Max ONE example per message. Only if concept is abstract. No confusing metaphors.",
        "NO DOUBLE EXAMPLES: Never give two examples (e.g. football AND mangoes). Choose one.",
        // âœ… CHANGED: Context-aware stepping
        "CONDITIONAL STEPS: Use 'Step one' ONLY when guiding a multi-step math problem or procedure. Do NOT use it for definitions or chat."
    ],
    formatting: [
        "Natural paragraphs. No 'Micro-Idea:' labels.",
        "Short sentences (Under 60 words for readability).",
        "Plain text math (1/2). NO LaTeX commands.",
        "Parentheses: Only numbers inside (1/2). No words inside ((like this))."
    ],
    failureStrategy: "If a tool/video fails, do NOT announce the failure. Seamlessly pivot to explaining the concept yourself with confidence."
};
const ARABIC_PROFILE = {
    identity: "Ø£Ù†Øª 'Ø§Ù„Ù…Ø¹Ù„Ù… Ø³ØªÙŠØ¯ÙØ§Ø³Øª'ØŒ Ù…Ø¹Ù„Ù… Ù…Ù†Ù‡Ø¬ ÙƒØ§Ù…Ø¨Ø±ÙŠØ¯Ø¬ØŒ Ø­ÙƒÙŠÙ… ÙˆØµØ¨ÙˆØ±. ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø·ÙØ§Ù„.",
    tone: "ÙˆÙ‚ÙˆØ±ØŒ Ù…Ø´Ø¬Ø¹ØŒ Ø£Ø¨ÙˆÙŠØŒ Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… ÙˆØ§Ù„Ø³ÙƒÙŠÙ†Ø©.",
    culturalContext: "Ø£Ù†Øª Ù…Ø¹Ù„Ù… ØªÙ‚Ù„ÙŠØ¯ÙŠ Ù…Ø­ØªØ±Ù…. Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø§Ø±Ø§Øª Ù…Ø«Ù„ 'ÙŠØ§ Ø¨Ù†ÙŠ'ØŒ 'Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒ'. Ø§ÙÙ‡Ù… Ø§Ù„Ù„Ù‡Ø¬Ø§Øª Ø§Ù„Ø¹Ø§Ù…ÙŠØ© ÙˆÙ„ÙƒÙ† Ø£Ø¬Ø¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø§Ù„Ù…Ø¨Ø³Ø·Ø©.",
    rules: [
        "Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©: Ø§Ø´Ø±Ø­ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©. Ø«Ù… Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ø§Ù‹.",
        "Ù„Ø§ Ù„Ù„Ø³Ø±Ø¯ Ø§Ù„Ø·ÙˆÙŠÙ„: Ù„Ø§ ØªØ´Ø±Ø­ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©. Ù„Ø§ ØªØ¹Ø·Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙˆØ±Ø§Ù‹.",
        "Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ù‚Ø±Ø§Ø·ÙŠØ©: Ø¹Ù„Ù‘Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©. Ø§Ø®ØªÙ… ÙƒÙ„ Ø±Ø¯ Ø¨Ø³Ø¤Ø§Ù„.",
        "Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø£Ù…Ø«Ù„Ø©: Ù…Ø«Ø§Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰. Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø§Ø³ØªØ¹Ø§Ø±Ø§Øª Ù…Ø¹Ù‚Ø¯Ø©.",
        "Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…: Ø¹Ù†Ø¯ Ø°ÙƒØ± Ø¢ÙŠØ©ØŒ Ø§Ø´Ø±Ø­ Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¹Ø§Ù… ÙˆØ§Ù„Ø£Ø®Ù„Ø§Ù‚ÙŠ ÙÙ‚Ø·.",
        // âœ… CHANGED: Context-aware stepping
        "Ø®Ø·ÙˆØ§Øª Ù…Ø´Ø±ÙˆØ·Ø©: Ø§Ø³ØªØ®Ø¯Ù… 'Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰' ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø®Ø·ÙˆØ§Øª."
    ],
    formatting: [
        "Ø§ØªØ¨Ø¹ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± (RTL) Ø¨ØµØ±Ø§Ù…Ø©.",
        "Ø§Ù„Ø£Ø±Ù‚Ø§Ù…: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (1ØŒ 2ØŒ 3).",
        "Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ…: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© (ØŸ ØŒ Ø›).",
        "Ù„Ø§ ØªØ®Ù„Ø· Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ø§ Ù„Ù„Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ù‚ØµÙˆÙ‰."
    ],
    failureStrategy: "Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ù…Ø¹Ù„ÙˆÙ…Ø©ØŒ Ù„Ø§ ØªØ¹ØªØ°Ø±. Ø§Ø¨Ø¯Ø£ ÙÙˆØ±Ø§Ù‹ Ø¨Ø´Ø±Ø­ Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø¨Ø£Ø³Ù„ÙˆØ¨Ùƒ Ø§Ù„Ø®Ø§Øµ ÙˆÙƒØ£Ù†Ùƒ Ø§Ù„Ù…Ø±Ø¬Ø¹."
};
const SWAHILI_PROFILE = {
    identity: "Wewe ni MWALIMU STEADFAST. Mwalimu wa Cambridge, mwerevu, mpole. Unafunza watoto.",
    tone: "Kirafiki, Heshima, Mchangamfu. Kama baba au mjomba.",
    culturalContext: "Tumia Kiswahili sanifu cha shuleni. Epuka Kiswahili cha vitabu vya zamani sana.",
    rules: [
        "HATUA MOJA: Fafanua hatua moja tu kwa wakati. Kisha uliza swali.",
        "USIMWAGE MAELEZO: Usifafanue somo zima mara moja. Usitoe jibu la mwisho haraka.",
        "NJIA YA SOCRATES: Fundisha pamoja na mwanafunzi. Maliza kila jibu na swali.",
        "MFANO MMOJA: Toa mfano mmoja tu. Usichanganye mifano miwili.",
        // âœ… CHANGED: Context-aware stepping
        "HATUA: Tumia 'Hatua ya kwanza' tu wakati wa kutatua hesabu. Usitumie kwa maelezo ya kawaida."
    ],
    formatting: [
        "Maelezo mafupi na ya moja kwa moja.",
        "Tumia nambari za kawaida (1, 2, 3)."
    ],
    failureStrategy: "Kama huna video au jibu la mtandao, usiseme 'samahani'. Anza kufafanua somo hilo kwa maneno yako mwenyewe."
};
const SHENG_PROFILE = {
    identity: "We ni Mwalimu Mtaani. Cambridge teacher but cool. Unafunza vijana.",
    tone: "Casual, Cool, Relatable but Respectful. 'Big Brother' vibes.",
    culturalContext: "Nairobi style. Tumia lugha ya vijana (Sheng) kuelezea vitu vigumu viwe rahisi.",
    rules: [
        "ONE STEP: Explain kitu moja, alafu uliza swali.",
        "NO DUMPING: Usilete lectures ndefu. Keep it short.",
        "SOCRATIC: Engage student. Usiwape jibu straight.",
        "ONE EXAMPLE: Mfano moja inatosha."
    ],
    formatting: [
        "Sentensi fupi fupi. Kama text message.",
        "No complex grammar."
    ],
    failureStrategy: "Kama tool imefail, usi-panic. Piga stori na uelezee hio concept mwenyewe."
};
function getLanguageGovernance(lang, interests) {
    const normalizedLang = (lang || 'english').toLowerCase();
    let profile = ENGLISH_PROFILE; // Default Fallback
    if (normalizedLang.includes('arab')) profile = ARABIC_PROFILE;
    else if (normalizedLang === 'swahili') profile = SWAHILI_PROFILE;
    else if (normalizedLang.includes('mix') || normalizedLang.includes('sheng')) profile = SHENG_PROFILE;
    // Personalization Block (Optimized for Tokens)
    const interestsBlock = interests.length > 0 ? `\n**PERSONALIZATION (MANDATORY)**\nStudent loves: ${interests.join(', ')}.\nINSTRUCTION: You MUST use these interests to explain concepts. Do NOT use generic examples.` : `\n**DEFAULT CONTEXT**\nUse general relatable Kenyan examples (Mandazi, Farming, Matatu).`;
    // Final Prompt Construction
    return `
**SYSTEM IDENTITY**
${profile.identity}

**TONE & CULTURE**
${profile.tone}
${profile.culturalContext}
${interestsBlock}

**GOVERNANCE RULES (NON-NEGOTIABLE)**
${profile.rules.map((r)=>`- ${r}`).join('\n')}

**FORMATTING LAWS**
${profile.formatting.map((f)=>`- ${f}`).join('\n')}

**ERROR HANDLING STRATEGY**
${profile.failureStrategy}
`;
}
}}),
"[project]/AI/ai/flows/emotional-ai-copilot.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"4077985ba2be3968a67b3697a55dcdfd0fd3cda69a":"emotionalAICopilot"},"",""] */ __turbopack_context__.s({
    "emotionalAICopilot": (()=>emotionalAICopilot)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/openai/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$client$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__OpenAI__as__default$3e$__ = __turbopack_context__.i("[project]/node_modules/openai/client.mjs [app-rsc] (ecmascript) <export OpenAI as default>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$get$2d$youtube$2d$transcript$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/get-youtube-transcript.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$youtube$2d$search$2d$flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/youtube-search-flow.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$research$2d$orchestrator$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/research-orchestrator.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/tools/handlers.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$title$2d$generator$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/title-generator.ts [app-rsc] (ecmascript)");
// âœ… Import Scope Guardian
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$scope$2d$guardian$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/tools/scope-guardian.ts [app-rsc] (ecmascript)");
// âœ… NEW: Import Multilingual Governance
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$multilingual$2d$governance$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/tools/multilingual-governance.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
const openai = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$client$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__OpenAI__as__default$3e$__["default"]({
    apiKey: process.env.OPENAI_API_KEY
});
function validateAnswer(studentInput, correctAnswers) {
    const userAnswer = studentInput.trim().toLowerCase();
    if (userAnswer.length === 0) return false;
    return correctAnswers.some((ans)=>userAnswer.includes(ans.toLowerCase()));
}
async function emotionalAICopilot(input) {
    const rawInterests = input.preferences?.interests || [];
    console.log(`[ðŸ” TRACE] Student: ${input.studentProfile.name} | Interests: ${rawInterests.join(', ')}`);
    // ==============================================================================
    // ðŸ”’ SCOPE GUARDIAN (SAFETY LOCK)
    // ==============================================================================
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$scope$2d$guardian$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["isOutOfScope"])(input.text)) {
        console.log(`[ðŸ›¡ï¸ SCOPE GUARDIAN] Blocked input: "${input.text}"`);
        return {
            processedText: (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$scope$2d$guardian$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getDynamicScopeResponse"])(input.text),
            state: input.state,
            topic: input.state.lastSearchTopic?.[0] || "General",
            suggestedTitle: input.currentTitle,
            videoData: undefined,
            sources: []
        };
    }
    // --- Normal Flow Continues Below ---
    let updatedState = JSON.parse(JSON.stringify(input.state));
    if (updatedState.validationAttemptCount === undefined) updatedState.validationAttemptCount = 0;
    if (updatedState.awaitingPracticeQuestionAnswer === undefined) updatedState.awaitingPracticeQuestionAnswer = false;
    let responseText = '';
    let videoData = undefined;
    let suggestedTitle = undefined;
    // ==============================================================================
    // 1. TITLE GENERATION (SMART UPDATE)
    // ==============================================================================
    const isGenericTitle = !input.currentTitle || input.currentTitle === 'New Chat' || input.currentTitle === 'Untitled';
    if (isGenericTitle && input.text.length > 1) {
        const newTitle = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$title$2d$generator$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["generateChatTitle"])(input.chatHistory, input.text);
        if (newTitle && newTitle !== "New Chat" && newTitle !== "General Discussion") {
            suggestedTitle = newTitle;
        }
    }
    // ==============================================================================
    // 2. RESEARCH ORCHESTRATOR ROUTING
    // ==============================================================================
    if (input.forceWebSearch || updatedState.conversationState === 'awaiting_practice_response') {
        console.log("[ðŸ” TRACE] Handing off to Research Orchestrator");
        const researchResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$research$2d$orchestrator$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runResearchOrchestrator"])({
            query: input.text,
            lastSearchTopic: updatedState.lastTopic,
            forceWebSearch: input.forceWebSearch,
            chatHistory: input.chatHistory.map((m)=>({
                    role: m.role,
                    content: m.content
                }))
        });
        updatedState.conversationState = 'general';
        let rawResponse = researchResult.reply || researchResult.response || "I checked, but I couldn't generate a clear answer. Let's try chatting about it directly.";
        const sources = researchResult.sources || [];
        // VIDEO HANDLING
        if (researchResult.videoData) {
            const vData = researchResult.videoData;
            const currentContext = (updatedState.lastTopic || input.text).toLowerCase();
            const videoTitleLower = (vData.title || "").toLowerCase();
            const stopWords = [
                'about',
                'what',
                'how',
                'when',
                'why',
                'video',
                'show',
                'me'
            ];
            const topicKeywords = currentContext.split(' ').filter((w)=>w.length > 3 && !stopWords.includes(w));
            const isRelevant = topicKeywords.some((w)=>videoTitleLower.includes(w)) || videoTitleLower.includes(currentContext);
            if (isRelevant && vData.id) {
                videoData = vData;
                const cleanTitle = (videoData.title || "Educational Video").replace(/[\[\]]/g, '');
                rawResponse += `\n\n[Watch Video: ${cleanTitle}](https://www.youtube.com/watch?v=${vData.id})`;
            }
        }
        if (researchResult.mode === 'teaching' || researchResult.mode === 'web_research') {
            updatedState.lastTopic = input.text;
        }
        const sanitizedResponse = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(rawResponse, updatedState.lastTopic);
        updatedState.lastAssistantMessage = sanitizedResponse;
        return {
            processedText: sanitizedResponse,
            state: updatedState,
            topic: updatedState.lastTopic,
            sources: sources,
            videoData: videoData,
            suggestedTitle: suggestedTitle
        };
    }
    // ==============================================================================
    // 3. PRACTICE QUESTION LOGIC
    // ==============================================================================
    if (updatedState.awaitingPracticeQuestionAnswer) {
        const isCorrect = validateAnswer(input.text, updatedState.correctAnswers || []);
        if (isCorrect) {
            const topic = updatedState.lastTopic || 'that';
            responseText = `Excellent ðŸŒŸ! Mashallah, yes. You understand ${topic}. Ready for the next step?`;
            updatedState.awaitingPracticeQuestionAnswer = false;
            updatedState.validationAttemptCount = 0;
            updatedState.activePracticeQuestion = undefined;
            updatedState.correctAnswers = [];
        } else {
            updatedState.validationAttemptCount = (updatedState.validationAttemptCount || 0) + 1;
            responseText = updatedState.validationAttemptCount > 1 ? "Let us take it slowly. Let's count together." : "Good try, but let's look closer.";
        }
        const sanitizedText = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(responseText, updatedState.lastTopic);
        updatedState.lastAssistantMessage = sanitizedText;
        return {
            processedText: sanitizedText,
            state: updatedState,
            suggestedTitle: suggestedTitle
        };
    }
    // ==============================================================================
    // 4. DYNAMIC SYSTEM PROMPT (MULTILINGUAL GOVERNANCE)
    // ==============================================================================
    const languageMode = input.preferences?.preferredLanguage || 'english';
    // âœ… LOG GOVERNANCE LOADING (VERIFY STRICT RULES ARE ACTIVE)
    console.log(`[GOVERNANCE] Loading Strict Rules for: ${languageMode}`);
    // âœ… NEW: Fetch Governed Prompt based on Language + Interests
    const TEACHING_PROMPT = (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$multilingual$2d$governance$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getLanguageGovernance"])(languageMode, rawInterests);
    const RESEARCH_PROMPT = `
  **IDENTITY**
  Calm, neutral research assistant.
  **RULES**
  - Factual, clear, direct.
  - No metaphors unless helpful.
  - Direct answers.
  `;
    const isResearchIntent = input.text.toLowerCase().includes('search') || input.text.toLowerCase().includes('find') || input.forceWebSearch;
    const systemMessage = isResearchIntent ? RESEARCH_PROMPT : TEACHING_PROMPT;
    const messages = [
        {
            role: 'system',
            content: systemMessage
        },
        ...input.chatHistory.map((msg)=>({
                role: msg.role === 'model' ? 'assistant' : msg.role,
                content: msg.content
            })),
        {
            role: 'user',
            content: input.text
        }
    ];
    if (input.fileData) {
        const lastMsgIndex = messages.length - 1;
        if (messages[lastMsgIndex].role === 'user') {
            messages[lastMsgIndex] = {
                role: 'user',
                content: [
                    {
                        type: 'text',
                        text: input.text
                    },
                    {
                        type: 'image_url',
                        image_url: {
                            url: `data:${input.fileData.type};base64,${input.fileData.base64}`
                        }
                    }
                ]
            };
        }
    }
    // ==============================================================================
    // 5. TOOLS & EXECUTION
    // ==============================================================================
    const tools = [
        {
            type: 'function',
            function: {
                name: 'ask_practice_question',
                description: 'Ask validation question.',
                parameters: {
                    type: 'object',
                    properties: {
                        question: {
                            type: 'string'
                        },
                        correctAnswers: {
                            type: 'string'
                        },
                        topic: {
                            type: 'string'
                        }
                    },
                    required: [
                        'question',
                        'correctAnswers',
                        'topic'
                    ]
                }
            }
        },
        {
            type: 'function',
            function: {
                name: 'youtube_search',
                description: 'Search educational video.',
                parameters: {
                    type: 'object',
                    properties: {
                        query: {
                            type: 'string'
                        }
                    },
                    required: [
                        'query'
                    ]
                }
            }
        },
        {
            type: 'function',
            function: {
                name: 'get_youtube_transcript',
                description: "Fetch transcript.",
                parameters: {
                    type: 'object',
                    properties: {
                        videoId: {
                            type: 'string'
                        }
                    },
                    required: [
                        'videoId'
                    ]
                }
            }
        }
    ];
    console.log('[BRAIN] Querying OpenAI...');
    const completion = await openai.chat.completions.create({
        messages: messages,
        model: 'gpt-4o-mini',
        tools: tools,
        tool_choice: 'auto'
    });
    const responseMessage = completion.choices[0].message;
    if (responseMessage.tool_calls && responseMessage.tool_calls.length > 0) {
        const toolCall = responseMessage.tool_calls[0];
        const functionName = toolCall.function.name;
        const args = JSON.parse(toolCall.function.arguments);
        if (functionName === 'ask_practice_question') {
            updatedState.awaitingPracticeQuestionAnswer = true;
            updatedState.activePracticeQuestion = args.question;
            updatedState.correctAnswers = args.correctAnswers.split(',').map((a)=>a.trim().toLowerCase());
            updatedState.lastTopic = args.topic;
            updatedState.validationAttemptCount = 0;
            responseText = `Here is a small challenge: What is (${updatedState.activePracticeQuestion})?`;
        } else if (functionName === 'youtube_search') {
            try {
                const results = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$youtube$2d$search$2d$flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["youtubeSearchFlow"], {
                    query: args.query
                });
                if (results && results.length > 0) {
                    const video = results[0];
                    const currentTopic = updatedState.lastTopic || input.text;
                    const vidTitleLower = (video.title || "").toLowerCase();
                    const contextLower = currentTopic.toLowerCase();
                    // FUZZY MATCH
                    const stopWords = [
                        'what',
                        'how',
                        'when',
                        'video',
                        'about'
                    ];
                    const keywords = contextLower.split(' ').filter((w)=>w.length > 3 && !stopWords.includes(w));
                    const isRelevant = keywords.some((k)=>vidTitleLower.includes(k)) || vidTitleLower.includes(contextLower);
                    if (isRelevant) {
                        const safeChannel = (video.channel || video.channelTitle || '').replace('Unknown Channel', '');
                        videoData = {
                            id: video.id,
                            title: video.title,
                            channel: safeChannel,
                            thumbnail: video.thumbnailUrl
                        };
                        const cleanTitle = (video.title || "Video").replace(/[\[\]]/g, '');
                        // âœ… Text Link Only
                        responseText = `I found a great video for you: "${video.title}".\n\n[Watch Video: ${cleanTitle}](https://www.youtube.com/watch?v=${video.id})`;
                    } else {
                        responseText = "Let me explain this to you step by step myself!";
                    }
                } else {
                    responseText = "Let's explore this topic directly together.";
                }
            } catch (error) {
                console.error('[BRAIN] Video Search Error:', error);
                responseText = "Let's just talk about this directly.";
            }
        } else if (functionName === 'get_youtube_transcript') {
            if (!args.videoId) {
                responseText = "Let's discuss the topic directly!";
            } else {
                const transcript = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$get$2d$youtube$2d$transcript$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getYoutubeTranscriptFlow"], args);
                if (!transcript || transcript.startsWith('Could not')) {
                    responseText = `I can't access that transcript right now. What specific part would you like me to explain?`;
                } else {
                    const safeTranscript = transcript.length > 50000 ? transcript.substring(0, 50000) + "..." : transcript;
                    const newMessages = [
                        ...messages,
                        responseMessage,
                        {
                            role: 'tool',
                            tool_call_id: toolCall.id,
                            content: safeTranscript
                        }
                    ];
                    const secondCompletion = await openai.chat.completions.create({
                        messages: newMessages,
                        model: 'gpt-4o'
                    });
                    responseText = secondCompletion.choices[0].message.content || "I watched the video. What would you like to know?";
                }
            }
        }
    } else {
        responseText = responseMessage.content || "I'm here to help!";
    }
    if (!updatedState.lastTopic && input.forceWebSearch) updatedState.lastTopic = input.text;
    // Pass user interests to sanitizer for fine-tuning
    const sanitizedFinalText = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$tools$2f$handlers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GUARDIAN_SANITIZE"])(responseText, updatedState.lastTopic);
    updatedState.lastAssistantMessage = sanitizedFinalText;
    return {
        processedText: sanitizedFinalText,
        videoData,
        state: updatedState,
        topic: updatedState.lastTopic || input.text,
        suggestedTitle
    };
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    emotionalAICopilot
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(emotionalAICopilot, "4077985ba2be3968a67b3697a55dcdfd0fd3cda69a", null);
}}),
"[project]/AI/ai/flows/personalize-daily-objectives.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
// src/ai/flows/personalize-daily-objectives.ts
/* __next_internal_action_entry_do_not_use__ [{"402be9f831be8d00b90cd9bd0831223bf06696c645":"personalizedObjectives"},"",""] */ __turbopack_context__.s({
    "personalizedObjectives": (()=>personalizedObjectives)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
/**
 * @fileOverview Generates personalized daily objectives for students based on their performance and the curriculum.
 *
 * - personalizedObjectives - A function that generates personalized daily objectives.
 * - PersonalizedObjectivesInput - The input type for the personalizedObjectives function.
 * - PersonalizedObjectivesOutput - The return type for the personalizedObjectives function.
 */ var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/genkit/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/genkit/lib/common.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/openai/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$client$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__OpenAI__as__default$3e$__ = __turbopack_context__.i("[project]/node_modules/openai/client.mjs [app-rsc] (ecmascript) <export OpenAI as default>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
;
const openai = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$openai$2f$client$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__OpenAI__as__default$3e$__["default"]({
    apiKey: process.env.OPENAI_API_KEY,
    timeout: 30000
});
const PersonalizedObjectivesInputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    studentPerformance: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().describe('The student\u2019s recent academic performance data.'),
    curriculum: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().describe('The curriculum for the current lesson or day.'),
    loggedMisconceptions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().describe('Any misconceptions the student has demonstrated.')
});
const PersonalizedObjectivesOutputSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    dailyObjectives: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].array(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$genkit$2f$lib$2f$common$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().describe('A list of 2-5 personalized daily objectives for the student.')).describe('An array of personalized daily objectives')
});
async function personalizedObjectives(input) {
    return personalizedObjectivesFlow(input);
}
const personalizedObjectivesFlow = async (input)=>{
    const systemMessage = `You are **Steadfast Copilot AI**, a supportive and insightful teacher for Kenyan students.
Your task is to create a short, personalized list of daily objectives to help a student focus their learning for the day.
The objectives should be clear, encouraging, and directly related to their recent performance, the curriculum, and any misconceptions they have.

Keep the objectives:
- **Action-oriented:** Start with a verb (e.g., "Review," "Practice," "Explain").
- **Specific:** Clearly state the topic or skill to work on.
- **Positive and encouraging:** Frame the objectives in a way that builds confidence.
- **Concise:** Generate between 2 to 4 objectives.

Here is the student's information:
- **Student Performance:** ${input.studentPerformance}
- **Today's Curriculum:** ${input.curriculum}
- **Logged Misconceptions:** ${input.loggedMisconceptions}

Based on this, create a list of daily objectives.`;
    const completion = await openai.chat.completions.create({
        messages: [
            {
                role: 'system',
                content: systemMessage
            }
        ],
        model: 'gpt-4o-mini'
    });
    const objectivesString = completion.choices[0].message.content || '';
    const dailyObjectives = objectivesString.split('\n').filter((obj)=>obj.trim() !== '');
    return {
        dailyObjectives
    };
};
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    personalizedObjectives
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(personalizedObjectives, "402be9f831be8d00b90cd9bd0831223bf06696c645", null);
}}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}}),
"[project]/AI/lib/prisma.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
;
const prisma = new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]();
const __TURBOPACK__default__export__ = prisma;
}}),
"[project]/frontend/app/actions.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"408ea425235fc7ec0d42b29d1796fee89f69b0776f":"searchYouTube","707f687be101932e3a517e3e5724727d27e4ad5343":"getDailyObjectives","7ffb0850d8356f1302247d1a1a0765dd4d440d4972":"getAssistantResponse"},"",""] */ __turbopack_context__.s({
    "getAssistantResponse": (()=>getAssistantResponse),
    "getDailyObjectives": (()=>getDailyObjectives),
    "searchYouTube": (()=>searchYouTube)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$emotional$2d$ai$2d$copilot$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/emotional-ai-copilot.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$personalize$2d$daily$2d$objectives$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/personalize-daily-objectives.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$youtube$2d$search$2d$flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/ai/flows/youtube-search-flow.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/index.mjs [app-rsc] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@genkit-ai/flow/lib/flow.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/AI/lib/prisma.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
/**
 * Helper to save message to DB (mimics backend logic)
 */ async function saveMessageToDb(sessionId, role, content) {
    try {
        if (!sessionId) return;
        const sessionExists = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"].chatSession.findUnique({
            where: {
                id: sessionId
            },
            select: {
                id: true
            }
        });
        if (!sessionExists) {
            return;
        }
        const count = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"].chatMessage.count({
            where: {
                sessionId
            }
        });
        await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"].chatMessage.create({
            data: {
                sessionId,
                role,
                content,
                timestamp: new Date(),
                messageNumber: count + 1
            }
        });
    } catch (error) {
    // console.error('Error saving message to DB:', error);
    }
}
/**
 * Helper to update session state and title
 */ async function updateSessionState(sessionId, state, topic, title) {
    if (!sessionId) return;
    // ðŸ” LOGGING: Checking what we are trying to save
    console.log(`[ACTION LOG] Attempting DB Update. ID: ${sessionId}, Title: "${title}"`);
    const data = {
        updatedAt: new Date(),
        metadata: state
    };
    // âœ… UPDATE TITLE IF PROVIDED
    if (title && title !== "New Chat") {
        data.topic = title; // Map 'title' to 'topic' column
    }
    // UPDATE INTERNAL TOPIC (If separate from title)
    if (topic && !title) {
        data.topic = topic;
    }
    await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"].chatSession.update({
        where: {
            id: sessionId
        },
        data
    });
}
// FETCH MEMORY HELPER
async function fetchStudentMemory() {
    try {
        return {
            progress: [],
            mistakes: []
        };
    } catch (e) {
        return {
            progress: [],
            mistakes: []
        };
    }
}
async function getAssistantResponse(sessionId, message, chatHistory, currentState, fileDataBase64, forceWebSearch, includeVideos, preferences, studentMemory) {
    try {
        // 1. Save User Message (Safely)
        if (sessionId) {
            await saveMessageToDb(sessionId, 'user', message);
        }
        // âœ… FETCH CURRENT TITLE TO PASS TO AI
        // This allows the AI to know if it needs to generate a title (if current is 'New Chat')
        let currentTitle = 'New Chat';
        if (sessionId) {
            try {
                const currentSession = await __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"].chatSession.findUnique({
                    where: {
                        id: sessionId
                    },
                    select: {
                        topic: true
                    }
                });
                if (currentSession?.topic) {
                    currentTitle = currentSession.topic;
                }
            } catch (e) {
            // Ignore DB read error, default to New Chat
            }
        }
        // 2. Run AI
        console.log("[ACTION LOG] Calling Emotional AI...");
        const response = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$emotional$2d$ai$2d$copilot$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["emotionalAICopilot"])({
            text: message,
            chatHistory: chatHistory,
            state: currentState,
            preferences: preferences,
            fileData: fileDataBase64,
            forceWebSearch,
            includeVideos,
            memory: studentMemory,
            currentTitle: currentTitle,
            studentProfile: {
                name: preferences.name || 'Student',
                gradeLevel: preferences.gradeLevel || 'Primary' // Ensure grade is passed
            }
        });
        console.log(`[ACTION LOG] AI Finished. Suggested Title: "${response.suggestedTitle}"`);
        // 3. Save AI Response & Try Update Title
        if (sessionId) {
            await saveMessageToDb(sessionId, 'model', response.processedText);
            // ðŸ›¡ï¸ CRITICAL FIX: TRY/CATCH AROUND DB UPDATE
            try {
                await updateSessionState(sessionId, response.state, response.topic, response.suggestedTitle);
            } catch (dbError) {
                console.warn("âš ï¸ [ACTION LOG] DB Write Failed (RLS/Auth). Returning title to Client for fallback save.");
            }
        }
        return {
            processedText: response.processedText,
            videoData: response.videoData ?? undefined,
            state: response.state,
            // âœ… VITAL FIX: Pass suggestedTitle as 'topic' so frontend detects it
            topic: response.suggestedTitle || response.topic,
            suggestedTitle: response.suggestedTitle
        };
    } catch (err) {
        console.error('[SERVER ACTION FATAL ERROR]', err);
        return {
            processedText: 'I am sorry, but something went wrong while processing that. Could you try again?',
            videoData: undefined,
            state: currentState,
            topic: undefined
        };
    }
}
async function getDailyObjectives(studentPerformance, curriculum, loggedMisconceptions) {
    try {
        const objectivesInput = {
            studentPerformance,
            curriculum,
            loggedMisconceptions
        };
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$personalize$2d$daily$2d$objectives$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["personalizedObjectives"])(objectivesInput);
        return result.dailyObjectives;
    } catch (err) {
        console.error('[SERVER ACTION BRIDGE ERROR - Objectives]', err);
        return [
            'Review today\'s key concepts.',
            'Practice one core problem.'
        ];
    }
}
async function searchYouTube(query) {
    try {
        const results = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$genkit$2d$ai$2f$flow$2f$lib$2f$flow$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["runFlow"])(__TURBOPACK__imported__module__$5b$project$5d2f$AI$2f$ai$2f$flows$2f$youtube$2d$search$2d$flow$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["youtubeSearchFlow"], {
            query
        });
        return results;
    } catch (error) {
        console.error('[SERVER ACTION BRIDGE ERROR - YouTube]', error);
        return [];
    }
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    getAssistantResponse,
    getDailyObjectives,
    searchYouTube
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(getAssistantResponse, "7ffb0850d8356f1302247d1a1a0765dd4d440d4972", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(getDailyObjectives, "707f687be101932e3a517e3e5724727d27e4ad5343", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(searchYouTube, "408ea425235fc7ec0d42b29d1796fee89f69b0776f", null);
}}),
"[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => \"[project]/frontend/app/actions.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <locals>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({});
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend/app/actions.ts [app-rsc] (ecmascript)");
;
}}),
"[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => \"[project]/frontend/app/actions.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <module evaluation>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({});
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend/app/actions.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f2e$next$2d$internal$2f$server$2f$app$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i('[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => "[project]/frontend/app/actions.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <locals>');
}}),
"[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => \"[project]/frontend/app/actions.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <exports>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "7ffb0850d8356f1302247d1a1a0765dd4d440d4972": (()=>__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getAssistantResponse"])
});
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend/app/actions.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f2e$next$2d$internal$2f$server$2f$app$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i('[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => "[project]/frontend/app/actions.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <locals>');
}}),
"[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => \"[project]/frontend/app/actions.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "7ffb0850d8356f1302247d1a1a0765dd4d440d4972": (()=>__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f2e$next$2d$internal$2f$server$2f$app$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$exports$3e$__["7ffb0850d8356f1302247d1a1a0765dd4d440d4972"])
});
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f2e$next$2d$internal$2f$server$2f$app$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i('[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => "[project]/frontend/app/actions.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <module evaluation>');
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f2e$next$2d$internal$2f$server$2f$app$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$frontend$2f$app$2f$actions$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$exports$3e$__ = __turbopack_context__.i('[project]/frontend/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => "[project]/frontend/app/actions.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <exports>');
}}),
"[project]/frontend/app/favicon.ico.mjs { IMAGE => \"[project]/frontend/app/favicon.ico (static in ecmascript)\" } [app-rsc] (structured image object, ecmascript, Next.js server component)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.n(__turbopack_context__.i("[project]/frontend/app/favicon.ico.mjs { IMAGE => \"[project]/frontend/app/favicon.ico (static in ecmascript)\" } [app-rsc] (structured image object, ecmascript)"));
}}),
"[project]/frontend/app/layout.tsx [app-rsc] (ecmascript, Next.js server component)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.n(__turbopack_context__.i("[project]/frontend/app/layout.tsx [app-rsc] (ecmascript)"));
}}),
"[project]/frontend/components/ui/avatar.tsx (client reference/proxy) <module evaluation>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "Avatar": (()=>Avatar),
    "AvatarFallback": (()=>AvatarFallback),
    "AvatarImage": (()=>AvatarImage)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server-edge.js [app-rsc] (ecmascript)");
;
const Avatar = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call Avatar() from the server but Avatar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/frontend/components/ui/avatar.tsx <module evaluation>", "Avatar");
const AvatarFallback = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call AvatarFallback() from the server but AvatarFallback is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/frontend/components/ui/avatar.tsx <module evaluation>", "AvatarFallback");
const AvatarImage = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call AvatarImage() from the server but AvatarImage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/frontend/components/ui/avatar.tsx <module evaluation>", "AvatarImage");
}}),
"[project]/frontend/components/ui/avatar.tsx (client reference/proxy)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "Avatar": (()=>Avatar),
    "AvatarFallback": (()=>AvatarFallback),
    "AvatarImage": (()=>AvatarImage)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server-edge.js [app-rsc] (ecmascript)");
;
const Avatar = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call Avatar() from the server but Avatar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/frontend/components/ui/avatar.tsx", "Avatar");
const AvatarFallback = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call AvatarFallback() from the server but AvatarFallback is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/frontend/components/ui/avatar.tsx", "AvatarFallback");
const AvatarImage = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call AvatarImage() from the server but AvatarImage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/frontend/components/ui/avatar.tsx", "AvatarImage");
}}),
"[project]/frontend/components/ui/avatar.tsx [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$28$client__reference$2f$proxy$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/frontend/components/ui/avatar.tsx (client reference/proxy) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$28$client__reference$2f$proxy$29$__ = __turbopack_context__.i("[project]/frontend/components/ui/avatar.tsx (client reference/proxy)");
;
__turbopack_context__.n(__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$28$client__reference$2f$proxy$29$__);
}}),
"[project]/frontend/components/header.tsx [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "Header": (()=>Header)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-jsx-dev-runtime.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend/components/ui/avatar.tsx [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$bot$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__default__as__Bot$3e$__ = __turbopack_context__.i("[project]/node_modules/lucide-react/dist/esm/icons/bot.js [app-rsc] (ecmascript) <export default as Bot>");
;
;
;
function Header() {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("header", {
        className: "sticky top-0 z-20 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",
        children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
            className: "container flex h-14 max-w-screen-2xl items-center justify-between px-4",
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex items-center gap-2",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                            className: "flex h-8 w-8 items-center justify-center rounded-full bg-primary",
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$lucide$2d$react$2f$dist$2f$esm$2f$icons$2f$bot$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$export__default__as__Bot$3e$__["Bot"], {
                                className: "h-5 w-5 text-primary-foreground"
                            }, void 0, false, {
                                fileName: "[project]/frontend/components/header.tsx",
                                lineNumber: 10,
                                columnNumber: 13
                            }, this)
                        }, void 0, false, {
                            fileName: "[project]/frontend/components/header.tsx",
                            lineNumber: 9,
                            columnNumber: 11
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                            className: "text-lg font-bold tracking-tight",
                            children: "Steadfast Copilot AI"
                        }, void 0, false, {
                            fileName: "[project]/frontend/components/header.tsx",
                            lineNumber: 12,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/frontend/components/header.tsx",
                    lineNumber: 8,
                    columnNumber: 9
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "flex items-center gap-4",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("span", {
                            className: "text-sm font-medium text-muted-foreground hidden sm:inline",
                            children: "Jane Doe"
                        }, void 0, false, {
                            fileName: "[project]/frontend/components/header.tsx",
                            lineNumber: 15,
                            columnNumber: 12
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["Avatar"], {
                            className: "h-9 w-9",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["AvatarImage"], {
                                    src: "https://picsum.photos/100/100",
                                    alt: "Student avatar",
                                    "data-ai-hint": "student avatar"
                                }, void 0, false, {
                                    fileName: "[project]/frontend/components/header.tsx",
                                    lineNumber: 17,
                                    columnNumber: 13
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$ui$2f$avatar$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["AvatarFallback"], {
                                    children: "JD"
                                }, void 0, false, {
                                    fileName: "[project]/frontend/components/header.tsx",
                                    lineNumber: 18,
                                    columnNumber: 13
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/frontend/components/header.tsx",
                            lineNumber: 16,
                            columnNumber: 11
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/frontend/components/header.tsx",
                    lineNumber: 14,
                    columnNumber: 9
                }, this)
            ]
        }, void 0, true, {
            fileName: "[project]/frontend/components/header.tsx",
            lineNumber: 7,
            columnNumber: 7
        }, this)
    }, void 0, false, {
        fileName: "[project]/frontend/components/header.tsx",
        lineNumber: 6,
        columnNumber: 5
    }, this);
}
}}),
"[project]/frontend/app/page.tsx [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>Home)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-jsx-dev-runtime.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$header$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend/components/header.tsx [app-rsc] (ecmascript)");
;
;
function Home() {
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["Fragment"], {
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$frontend$2f$components$2f$header$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["Header"], {}, void 0, false, {
                fileName: "[project]/frontend/app/page.tsx",
                lineNumber: 12,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("main", {
                className: "flex-1 p-4 sm:p-6 md:p-8",
                children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                    className: "mx-auto max-w-4xl",
                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                        className: "mb-8",
                        children: [
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("h1", {
                                className: "text-3xl font-bold tracking-tight",
                                children: "Student Dashboard"
                            }, void 0, false, {
                                fileName: "[project]/frontend/app/page.tsx",
                                lineNumber: 16,
                                columnNumber: 13
                            }, this),
                            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])("p", {
                                className: "text-muted-foreground",
                                children: "Welcome back, let's continue your learning journey!"
                            }, void 0, false, {
                                fileName: "[project]/frontend/app/page.tsx",
                                lineNumber: 17,
                                columnNumber: 13
                            }, this)
                        ]
                    }, void 0, true, {
                        fileName: "[project]/frontend/app/page.tsx",
                        lineNumber: 15,
                        columnNumber: 11
                    }, this)
                }, void 0, false, {
                    fileName: "[project]/frontend/app/page.tsx",
                    lineNumber: 14,
                    columnNumber: 9
                }, this)
            }, void 0, false, {
                fileName: "[project]/frontend/app/page.tsx",
                lineNumber: 13,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true);
}
}}),
"[project]/frontend/app/page.tsx [app-rsc] (ecmascript, Next.js server component)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.n(__turbopack_context__.i("[project]/frontend/app/page.tsx [app-rsc] (ecmascript)"));
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__fd57f192._.js.map